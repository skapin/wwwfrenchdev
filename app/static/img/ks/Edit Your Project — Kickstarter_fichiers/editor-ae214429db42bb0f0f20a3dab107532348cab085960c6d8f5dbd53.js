if(window.rangy=function(){function e(e,t){var i=typeof e[t];return i==u||!(i!=c||!e[t])||"unknown"==i}function t(e,t){return!(typeof e[t]!=c||!e[t])}function i(e,t){return typeof e[t]!=h}function n(e){return function(t,i){for(var n=i.length;n--;)if(!e(t,i[n]))return!1;return!0}}function o(e){return e&&g(e,_)&&v(e,m)}function r(e){window.alert("Rangy not supported in your browser. Reason: "+e),w.initialized=!0,w.supported=!1}function s(e){var t="Rangy warning: "+e;w.config.alertOnWarn?window.alert(t):typeof window.console!=h&&typeof window.console.log!=h&&window.console.log(t)}function a(){if(!w.initialized){var i,n=!1,s=!1;e(document,"createRange")&&(i=document.createRange(),g(i,f)&&v(i,p)&&(n=!0),i.detach());var a=t(document,"body")?document.body:document.getElementsByTagName("body")[0];a&&e(a,"createTextRange")&&(i=a.createTextRange(),o(i)&&(s=!0)),n||s||r("Neither Range nor TextRange are implemented"),w.initialized=!0,w.features={implementsDomRange:n,implementsTextRange:s};for(var l=S.concat(C),d=0,c=l.length;c>d;++d)try{l[d](w)}catch(u){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",u)}}}function l(e){e=e||window,a();for(var t=0,i=b.length;i>t;++t)b[t](e)}function d(e){this.name=e,this.initialized=!1,this.supported=!1}var c="object",u="function",h="undefined",p=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],f=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],m=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],_=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],g=n(e),y=n(t),v=n(i),w={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:i,areHostMethods:g,areHostObjects:y,areHostProperties:v,isTextRange:o},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};w.fail=r,w.warn=s,{}.hasOwnProperty?w.util.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}:r("hasOwnProperty not supported");var C=[],S=[];w.init=a,w.addInitListener=function(e){w.initialized?e(w):C.push(e)};var b=[];w.addCreateMissingNativeApiListener=function(e){b.push(e)},w.createMissingNativeApi=l,d.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},d.prototype.warn=function(e){w.warn("Module "+this.name+": "+e)},d.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},w.createModule=function(e,t){var i=new d(e);w.modules[e]=i,S.push(function(e){t(e,i),i.initialized=!0,i.supported=!0})},w.requireModules=function(e){for(var t,i,n=0,o=e.length;o>n;++n){if(i=e[n],t=w.modules[i],!(t&&t instanceof d))throw new Error("Module '"+i+"' not found");if(!t.supported)throw new Error("Module '"+i+"' not supported")}};var N=!1,E=function(e){N||(N=!0,w.initialized||a())};return typeof window==h?void r("No window found"):typeof document==h?void r("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",E,!1),e(window,"addEventListener")?window.addEventListener("load",E,!1):e(window,"attachEvent")?window.attachEvent("onload",E):r("Window does not have required addEventListener or attachEvent method"),w)}(),rangy.createModule("DomUtil",function(e,t){function i(e){var t;return typeof e.namespaceURI==E||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function n(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)t++;return t}function r(e){var t;return d(e)?e.length:(t=e.childNodes)?t.length:0}function s(e,t){var i,n=[];for(i=e;i;i=i.parentNode)n.push(i);for(i=t;i;i=i.parentNode)if(W(n,i))return i;return null}function a(e,t,i){for(var n=i?t:t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function l(e,t,i){for(var n,o=i?e:e.parentNode;o;){if(n=o.parentNode,n===t)return o;o=n}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function c(e,t){var i=t.nextSibling,n=t.parentNode;return i?n.insertBefore(e,i):n.appendChild(e),e}function u(e,t){var i=e.cloneNode(!1);return i.deleteData(0,t),e.deleteData(t,e.length-t),c(i,e),i}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=E)return e.ownerDocument;if(typeof e.document!=E)return e.document;if(e.parentNode)return h(e.parentNode);throw new Error("getDocument: no document found for node")}function p(e){var t=h(e);if(typeof t.defaultView!=E)return t.defaultView;if(typeof t.parentWindow!=E)return t.parentWindow;throw new Error("Cannot get a window object for node")}function f(e){if(typeof e.contentDocument!=E)return e.contentDocument;if(typeof e.contentWindow!=E)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function m(e){if(typeof e.contentWindow!=E)return e.contentWindow;if(typeof e.contentDocument!=E)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function _(e){return M.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function g(e){for(var t;t=e.parentNode;)e=t;return e}function y(e,t,i,n){var r,a,d,c,u;if(e==i)return t===n?0:n>t?-1:1;if(r=l(i,e,!0))return t<=o(r)?-1:1;if(r=l(e,i,!0))return o(r)<n?-1:1;if(a=s(e,i),d=e===a?a:l(e,a,!0),c=i===a?a:l(i,a,!0),d===c)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(u=a.firstChild;u;){if(u===d)return-1;if(u===c)return 1;u=u.nextSibling}throw new Error("Should not be here!")}function v(e){for(var t,i=h(e).createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i}function w(e){if(!e)return"[No node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function C(e){this.root=e,this._next=e}function S(e){return new C(e)}function b(e,t){this.node=e,this.offset=t}function N(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var E="undefined",M=e.util;M.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),M.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var T=document.createElement("div");M.areHostMethods(T,["insertBefore","appendChild","cloneNode"]||!M.areHostObjects(T,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),M.isHostProperty(T,"innerHTML")||t.fail("Element is missing innerHTML property");var I=document.createTextNode("test");M.areHostMethods(I,["splitText","deleteData","insertData","appendData","cloneNode"]||!M.areHostObjects(T,["previousSibling","nextSibling","childNodes","parentNode"])||!M.areHostProperties(I,["data"]))||t.fail("Incomplete Text Node implementation");var W=function(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1};C.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,i=this._current=this._next;if(this._current)if(e=i.firstChild)this._next=e;else{for(t=null;i!==this.root&&!(t=i.nextSibling);)i=i.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},b.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"}},N.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},N.prototype.toString=function(){return this.message},e.dom={arrayContains:W,isHtmlNamespace:i,parentElement:n,getNodeIndex:o,getNodeLength:r,getCommonAncestor:s,isAncestorOf:a,getClosestAncestorIn:l,isCharacterDataNode:d,insertAfter:c,splitDataNode:u,getDocument:h,getWindow:p,getIframeWindow:m,getIframeDocument:f,getBody:_,getRootContainer:g,comparePoints:y,inspectNode:w,fragmentFromNodeChildren:v,createIterator:S,DomPosition:b},e.DOMException=N}),rangy.createModule("DomRange",function(e,t){function i(e,t){return 3!=e.nodeType&&(z.isAncestorOf(e,t.startContainer,!0)||z.isAncestorOf(e,t.endContainer,!0))}function n(e){return z.getDocument(e.startContainer)}function o(e,t,i){var n=e._listeners[t];if(n)for(var o=0,r=n.length;r>o;++o)n[o].call(e,{target:e,args:i})}function r(e){return new Q(e.parentNode,z.getNodeIndex(e))}function s(e){return new Q(e.parentNode,z.getNodeIndex(e)+1)}function a(e,t,i){var n=11==e.nodeType?e.firstChild:e;return z.isCharacterDataNode(t)?i==t.length?z.insertAfter(e,t):t.parentNode.insertBefore(e,0==i?t:z.splitDataNode(t,i)):i>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[i]),n}function l(e){for(var t,i,o,r=n(e.range).createDocumentFragment();i=e.next();){if(t=e.isPartiallySelectedSubtree(),i=i.cloneNode(!t),t&&(o=e.getSubtreeIterator(),i.appendChild(l(o)),o.detach(!0)),10==i.nodeType)throw new H("HIERARCHY_REQUEST_ERR");r.appendChild(i)}return r}function d(e,t,i){var n,o;i=i||{stop:!1};for(var r,s;r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return void(i.stop=!0);if(s=e.getSubtreeIterator(),d(s,t,i),s.detach(!0),i.stop)return}else for(n=z.createIterator(r);o=n.next();)if(t(o)===!1)return void(i.stop=!0)}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach(!0)):e.remove()}function u(e){for(var t,i,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(u(i)),i.detach(!0)):e.remove(),10==t.nodeType)throw new H("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function h(e,t,i){var n,o=!(!t||!t.length),r=!!i;o&&(n=new RegExp("^("+t.join("|")+")$"));var s=[];return d(new f(e,!1),function(e){o&&!n.test(e.nodeType)||r&&!i(e)||s.push(e)}),s}function p(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+z.inspectNode(e.startContainer)+":"+e.startOffset+", "+z.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function f(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var i=e.commonAncestorContainer;this.sc===this.ec&&z.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==i||z.isCharacterDataNode(this.sc)?z.getClosestAncestorIn(this.sc,i,!0):this.sc.childNodes[this.so],this._last=this.ec!==i||z.isCharacterDataNode(this.ec)?z.getClosestAncestorIn(this.ec,i,!0):this.ec.childNodes[this.eo-1])}}function m(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function _(e,t,i){this.nodes=h(e,t,i),this._next=this.nodes[0],this._position=0}function g(e){return function(t,i){for(var n,o=i?t:t.parentNode;o;){if(n=o.nodeType,z.arrayContains(e,n))return o;o=o.parentNode}return null}}function y(e,t){if(G(e,t))throw new m("INVALID_NODE_TYPE_ERR")}function v(e){if(!e.startContainer)throw new H("INVALID_STATE_ERR")}function w(e,t){if(!z.arrayContains(t,e.nodeType))throw new m("INVALID_NODE_TYPE_ERR")}function C(e,t){if(0>t||t>(z.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new H("INDEX_SIZE_ERR")}function S(e,t){if(K(e,!0)!==K(t,!0))throw new H("WRONG_DOCUMENT_ERR")}function b(e){if(V(e,!0))throw new H("NO_MODIFICATION_ALLOWED_ERR")}function N(e,t){if(!e)throw new H(t)}function E(e){return!z.arrayContains(P,e.nodeType)&&!K(e,!0)}function M(e,t){return t<=(z.isCharacterDataNode(e)?e.length:e.childNodes.length)}function T(e){return!!e.startContainer&&!!e.endContainer&&!E(e.startContainer)&&!E(e.endContainer)&&M(e.startContainer,e.startOffset)&&M(e.endContainer,e.endOffset)}function I(e){if(v(e),!T(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function W(){}function R(e){e.START_TO_START=te,e.START_TO_END=ie,e.END_TO_END=ne,e.END_TO_START=oe,e.NODE_BEFORE=re,e.NODE_AFTER=se,e.NODE_BEFORE_AND_AFTER=ae,e.NODE_INSIDE=le}function A(e){R(e),R(e.prototype)}function Y(e,t){return function(){I(this);var i,n,o=this.startContainer,r=this.startOffset,a=this.commonAncestorContainer,l=new f(this,!0);o!==a&&(i=z.getClosestAncestorIn(o,a,!0),n=s(i),o=n.node,r=n.offset),d(l,b),l.reset();var c=e(l);return l.detach(),t(this,o,r,o,r),c}}function x(t,n,o){function a(e,t){return function(i){v(this),w(i,k),w(F(i),P);var n=(e?r:s)(i);(t?l:d)(this,n.node,n.offset)}}function l(e,t,i){var o=e.endContainer,r=e.endOffset;(t!==e.startContainer||i!==e.startOffset)&&((F(t)!=F(o)||1==z.comparePoints(t,i,o,r))&&(o=t,r=i),n(e,t,i,o,r))}function d(e,t,i){var o=e.startContainer,r=e.startOffset;(t!==e.endContainer||i!==e.endOffset)&&((F(t)!=F(o)||-1==z.comparePoints(t,i,o,r))&&(o=t,r=i),n(e,o,r,t,i))}function h(e,t,i){(t!==e.startContainer||i!==e.startOffset||t!==e.endContainer||i!==e.endOffset)&&n(e,t,i,t,i)}t.prototype=new W,e.util.extend(t.prototype,{setStart:function(e,t){v(this),y(e,!0),C(e,t),l(this,e,t)},setEnd:function(e,t){v(this),y(e,!0),C(e,t),d(this,e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){I(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){v(this),y(e,!0),n(this,e,0,e,z.getNodeLength(e))},selectNode:function(e){v(this),y(e,!1),w(e,k);var t=r(e),i=s(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:Y(u,n),deleteContents:Y(c,n),canSurroundContents:function(){I(this),b(this.startContainer),b(this.endContainer);var e=new f(this,!0),t=e._first&&i(e._first,this)||e._last&&i(e._last,this);return e.detach(),!t},detach:function(){o(this)},splitBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,o=this.endOffset,r=e===i;z.isCharacterDataNode(i)&&o>0&&o<i.length&&z.splitDataNode(i,o),z.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=z.splitDataNode(e,t),r?(o-=t,i=e):i==e.parentNode&&o>=z.getNodeIndex(e)&&o++,t=0),n(this,e,t,i,o)},normalizeBoundaries:function(){I(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,o=this.endOffset,r=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,o=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},s=function(n){var r=n.previousSibling;if(r&&r.nodeType==n.nodeType){e=n;var s=n.length;if(t=r.length,n.insertData(0,r.data),r.parentNode.removeChild(r),e==i)o+=t,i=e;else if(i==n.parentNode){var a=z.getNodeIndex(n);o==a?(i=n,o=s):o>a&&o--}}},a=!0;if(z.isCharacterDataNode(i))i.length==o&&r(i);else{if(o>0){var l=i.childNodes[o-1];l&&z.isCharacterDataNode(l)&&r(l)}a=!this.collapsed}if(a){if(z.isCharacterDataNode(e))0==t&&s(e);else if(t<e.childNodes.length){var d=e.childNodes[t];d&&z.isCharacterDataNode(d)&&s(d)}}else e=i,t=o;n(this,e,t,i,o)},collapseToPoint:function(e,t){v(this),y(e,!0),C(e,t),h(this,e,t)}}),A(t)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:z.getCommonAncestor(e.startContainer,e.endContainer)}function L(e,t,i,n,r){var s=e.startContainer!==t||e.startOffset!==i,a=e.endContainer!==n||e.endOffset!==r;e.startContainer=t,e.startOffset=i,e.endContainer=n,e.endOffset=r,O(e),o(e,"boundarychange",{startMoved:s,endMoved:a})}function D(e){v(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,o(e,"detach",null),e._listeners=null}function j(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},O(this)}e.requireModules(["DomUtil"]);var z=e.dom,Q=z.DomPosition,H=e.DOMException;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,z.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,i=this._current;!z.isCharacterDataNode(i)||i!==this.sc&&i!==this.ec?i.parentNode&&i.parentNode.removeChild(i):(e=i===this.sc?this.so:0,t=i===this.ec?this.eo:i.length,e!=t&&i.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return i(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new j(n(this.range));var t=this._current,i=t,o=0,r=t,s=z.getNodeLength(t);z.isAncestorOf(t,this.sc,!0)&&(i=this.sc,o=this.so),z.isAncestorOf(t,this.ec,!0)&&(r=this.ec,s=this.eo),L(e,i,o,r,s)}return new f(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},m.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},m.prototype.toString=function(){return this.message},_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var k=[1,3,4,5,7,8,10],P=[2,9,11],B=[5,6,10,12],$=[1,3,4,5,7,8,10,11],U=[1,3,4,5,7,8],F=z.getRootContainer,K=g([9,11]),V=g(B),G=g([6,10,12]),q=document.createElement("style"),X=!1;try{q.innerHTML="<b>x</b>",X=3==q.firstChild.nodeType}catch(J){}e.features.htmlParsingConforms=X;var Z=X?function(e){var t=this.startContainer,i=z.getDocument(t);if(!t)throw new H("INVALID_STATE_ERR");var n=null;return 1==t.nodeType?n=t:z.isCharacterDataNode(t)&&(n=z.parentElement(t)),n=null===n||"HTML"==n.nodeName&&z.isHtmlNamespace(z.getDocument(n).documentElement)&&z.isHtmlNamespace(n)?i.createElement("body"):n.cloneNode(!1),n.innerHTML=e,z.fragmentFromNodeChildren(n)}:function(e){v(this);var t=n(this),i=t.createElement("body");return i.innerHTML=e,z.fragmentFromNodeChildren(i)},ee=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],te=0,ie=1,ne=2,oe=3,re=0,se=1,ae=2,le=3;W.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){I(this),S(this.startContainer,t.startContainer);var i,n,o,r,s=e==oe||e==te?"start":"end",a=e==ie||e==te?"start":"end";return i=this[s+"Container"],n=this[s+"Offset"],o=t[a+"Container"],r=t[a+"Offset"],z.comparePoints(i,n,o,r)},insertNode:function(e){if(I(this),w(e,$),b(this.startContainer),z.isAncestorOf(e,this.startContainer,!0))throw new H("HIERARCHY_REQUEST_ERR");var t=a(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){I(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&z.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var i=new f(this,!0);return e=l(i),i.detach(),e},canSurroundContents:function(){I(this),b(this.startContainer),b(this.endContainer);var e=new f(this,!0),t=e._first&&i(e._first,this)||e._last&&i(e._last,this);return e.detach(),!t},surroundContents:function(e){if(w(e,U),!this.canSurroundContents())throw new m("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){I(this);for(var e,t=new j(n(this)),i=ee.length;i--;)e=ee[i],t[e]=this[e];return t},toString:function(){I(this);var e=this.startContainer;if(e===this.endContainer&&z.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],i=new f(this,!0);return d(i,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),i.detach(),t.join("")},compareNode:function(e){I(this);var t=e.parentNode,i=z.getNodeIndex(e);if(!t)throw new H("NOT_FOUND_ERR");var n=this.comparePoint(t,i),o=this.comparePoint(t,i+1);return 0>n?o>0?ae:re:o>0?se:le},comparePoint:function(e,t){return I(this),N(e,"HIERARCHY_REQUEST_ERR"),S(e,this.startContainer),z.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:z.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){I(this);var e=n(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(I(this),N(e,"NOT_FOUND_ERR"),z.getDocument(e)!==n(this))return!1;var i=e.parentNode,o=z.getNodeIndex(e);N(i,"NOT_FOUND_ERR");var r=z.comparePoints(i,o,this.endContainer,this.endOffset),s=z.comparePoints(i,o+1,this.startContainer,this.startOffset);return t?0>=r&&s>=0:0>r&&s>0},isPointInRange:function(e,t){return I(this),N(e,"HIERARCHY_REQUEST_ERR"),S(e,this.startContainer),z.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&z.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if(I(this),n(e)!=n(this))throw new H("WRONG_DOCUMENT_ERR");var i=z.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),o=z.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=i&&o>=0:0>i&&o>0},intersection:function(e){if(this.intersectsRange(e)){var t=z.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),i=z.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),n=this.cloneRange();return-1==t&&n.setStart(e.startContainer,e.startOffset),1==i&&n.setEnd(e.endContainer,e.endOffset),n}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==z.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==z.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new m("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==le},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,z.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var i=t.getNodes([3]);if(i.length>0){t.setStart(i[0],0);var n=i.pop();t.setEnd(n,n.length);var o=this.containsRange(t);return t.detach(),o}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return I(this),new _(this,e,t)},getNodes:function(e,t){return I(this),h(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){v(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){v(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return j.rangesEqual(this,e)},isValid:function(){return T(this)},inspect:function(){return p(this)}},x(j,L,D),e.rangePrototype=W.prototype,j.rangeProperties=ee,j.RangeIterator=f,j.copyComparisonConstants=A,j.createPrototypeRange=x,j.inspect=p,j.getRangeDocument=n,j.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=j,e.RangeException=m}),rangy.createModule("WrappedRange",function(e,t){function i(e){var t=e.parentElement(),i=e.duplicate();i.collapse(!0);var n=i.parentElement();i=e.duplicate(),i.collapse(!1);var o=i.parentElement(),r=n==o?n:a.getCommonAncestor(n,o);return r==t?r:a.getCommonAncestor(t,r)}function n(e){return 0==e.compareEndPoints("StartToEnd",e)}function o(e,t,i,n){var o=e.duplicate();o.collapse(i);var r=o.parentElement();if(a.isAncestorOf(t,r,!0)||(r=t),!r.canHaveHTML)return new l(r.parentNode,a.getNodeIndex(r));var s,d,c,u,h,p=a.getDocument(r).createElement("span"),f=i?"StartToStart":"StartToEnd";do r.insertBefore(p,p.previousSibling),o.moveToElementText(p);while((s=o.compareEndPoints(f,e))>0&&p.previousSibling);if(h=p.nextSibling,-1==s&&h&&a.isCharacterDataNode(h)){o.setEndPoint(i?"EndToStart":"EndToEnd",e);var m;if(/[\r\n]/.test(h.data)){var _=o.duplicate(),g=_.text.replace(/\r\n/g,"\r").length;for(m=_.moveStart("character",g);-1==(s=_.compareEndPoints("StartToEnd",_));)m++,_.moveStart("character",1)}else m=o.text.length;u=new l(h,m)}else d=(n||!i)&&p.previousSibling,c=(n||i)&&p.nextSibling,u=c&&a.isCharacterDataNode(c)?new l(c,0):d&&a.isCharacterDataNode(d)?new l(d,d.length):new l(r,a.getNodeIndex(p));return p.parentNode.removeChild(p),u}function r(e,t){var i,n,o,r,s=e.offset,l=a.getDocument(e.node),d=l.body.createTextRange(),c=a.isCharacterDataNode(e.node);return c?(i=e.node,n=i.parentNode):(r=e.node.childNodes,i=s<r.length?r[s]:null,n=e.node),o=l.createElement("span"),o.innerHTML="&#feff;",i?n.insertBefore(o,i):n.appendChild(o),d.moveToElementText(o),d.collapse(!t),n.removeChild(o),c&&d[t?"moveStart":"moveEnd"]("character",s),d}e.requireModules(["DomUtil","DomRange"]);var s,a=e.dom,l=a.DomPosition,d=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){s=function(e){this.textRange=e,this.refresh()},s.prototype=new d(document),s.prototype.refresh=function(){var e,t,r=i(this.textRange);n(this.textRange)?t=e=o(this.textRange,r,!0,!0):(e=o(this.textRange,r,!0,!1),t=o(this.textRange,r,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},d.copyComparisonConstants(s);var c=function(){return this}();"undefined"==typeof c.Range&&(c.Range=s),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else!function(){function t(e){for(var t,i=c.length;i--;)t=c[i],e[t]=e.nativeRange[t]}function i(e,t,i,n,o){var r=e.startContainer!==t||e.startOffset!=i,s=e.endContainer!==n||e.endOffset!=o;(r||s)&&(e.setEnd(n,o),e.setStart(t,i))}function n(e){e.nativeRange.detach(),e.detached=!0;for(var t,i=c.length;i--;)t=c[i],e[t]=null}var o,r,l,c=d.rangeProperties;s=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,t(this)},d.createPrototypeRange(s,i,n),o=s.prototype,o.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},o.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},o.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},o.cloneContents=function(){return this.nativeRange.cloneContents()},o.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},o.collapse=function(e){this.nativeRange.collapse(e),t(this)},o.cloneRange=function(){return new s(this.nativeRange.cloneRange())},o.refresh=function(){t(this)},o.toString=function(){return this.nativeRange.toString()};var u=document.createTextNode("test");a.getBody(document).appendChild(u);var h=document.createRange();h.setStart(u,0),h.setEnd(u,0);try{h.setStart(u,1),r=!0,o.setStart=function(e,i){this.nativeRange.setStart(e,i),t(this)},o.setEnd=function(e,i){this.nativeRange.setEnd(e,i),t(this)},l=function(e){return function(i){this.nativeRange[e](i),t(this)}}}catch(p){r=!1,o.setStart=function(e,i){try{this.nativeRange.setStart(e,i)}catch(n){this.nativeRange.setEnd(e,i),this.nativeRange.setStart(e,i)}t(this)},o.setEnd=function(e,i){try{this.nativeRange.setEnd(e,i)}catch(n){this.nativeRange.setStart(e,i),this.nativeRange.setEnd(e,i)}t(this)},l=function(e,i){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[i](n),this.nativeRange[e](n)}t(this)}}}o.setStartBefore=l("setStartBefore","setEndBefore"),o.setStartAfter=l("setStartAfter","setEndAfter"),o.setEndBefore=l("setEndBefore","setStartBefore"),o.setEndAfter=l("setEndAfter","setStartAfter"),h.selectNodeContents(u),h.startContainer==u&&h.endContainer==u&&0==h.startOffset&&h.endOffset==u.length?o.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),t(this)}:o.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,d.getEndOffset(e))},h.selectNodeContents(u),h.setEnd(u,3);var f=document.createRange();f.selectNodeContents(u),f.setEnd(u,4),f.setStart(u,2),-1==h.compareBoundaryPoints(h.START_TO_END,f)&1==h.compareBoundaryPoints(h.END_TO_START,f)?o.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:o.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(h,"createContextualFragment")&&(o.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),a.getBody(document).removeChild(u),h.detach(),f.detach()}(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(s.rangeToTextRange=function(e){if(e.collapsed){var t=r(new l(e.startContainer,e.startOffset),!0);return t}var i=r(new l(e.startContainer,e.startOffset),!0),n=r(new l(e.endContainer,e.endOffset),!1),o=a.getDocument(e.startContainer).body.createTextRange();return o.setEndPoint("StartToStart",i),o.setEndPoint("EndToEnd",n),o}),s.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=s,e.createRange=function(t){return t=t||document,new s(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new d(e)},e.createIframeRange=function(t){return e.createRange(a.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(a.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var i=t.document;"undefined"==typeof i.createRange&&(i.createRange=function(){return e.createRange(this)}),i=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function i(e){return(e||window).getSelection()}function n(e){return(e||window).document.selection}function o(e,t,i){var n=i?"end":"start",o=i?"start":"end";e.anchorNode=t[n+"Container"],e.anchorOffset=t[n+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function r(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function s(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function a(t){var i;return t instanceof N?(i=t._selectionNativeRange,i||(i=e.createNativeRange(S.getDocument(t.startContainer)),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=i,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof E?i=t.nativeRange:e.features.implementsDomRange&&t instanceof S.getWindow(t.startContainer).Range&&(i=t),i}function l(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,i=e.length;i>t;++t)if(!S.isAncestorOf(e[0],e[t]))return!1;return!0}function d(e){var t=e.getNodes();if(!l(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function c(e){return!!e&&"undefined"!=typeof e.text}function u(e,t){var i=new E(t);e._ranges=[i],o(e,i,!1),e.rangeCount=1,e.isCollapsed=i.collapsed}function h(t){if(t._ranges.length=0,"None"==t.docSelection.type)s(t);else{var i=t.docSelection.createRange();if(c(i))u(t,i);else{t.rangeCount=i.length;for(var n,r=S.getDocument(i.item(0)),a=0;a<t.rangeCount;++a)n=e.createRange(r),n.selectNode(i.item(a)),t._ranges.push(n);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,o(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,t){for(var i=e.docSelection.createRange(),n=d(t),o=S.getDocument(i.item(0)),r=S.getBody(o).createControlRange(),s=0,a=i.length;a>s;++s)r.add(i.item(s));try{r.add(n)}catch(l){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),h(e)}function f(e,t,i){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=i,this.refresh()}function m(e,t){for(var i,n=S.getDocument(t[0].startContainer),o=S.getBody(n).createControlRange(),r=0;r<rangeCount;++r){
i=d(t[r]);try{o.add(i)}catch(s){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),h(e)}function _(e,t){if(e.anchorNode&&S.getDocument(e.anchorNode)!==S.getDocument(t))throw new M("WRONG_DOCUMENT_ERR")}function g(e){var t=[],i=new T(e.anchorNode,e.anchorOffset),n=new T(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var r=0,s=e.rangeCount;s>r;++r)t[r]=N.inspect(e.getRangeAt(r));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+i.inspect()+", focus: "+n.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var y,v,w="boolean",C="_rangySelection",S=e.dom,b=e.util,N=e.DomRange,E=e.WrappedRange,M=e.DOMException,T=S.DomPosition,I="Control",W=e.util.isHostMethod(window,"getSelection"),R=e.util.isHostObject(document,"selection"),A=R&&(!W||e.config.preferTextRange);A?(y=n,e.isSelectionValid=function(e){var t=(e||window).document,i=t.selection;return"None"!=i.type||S.getDocument(i.createRange().parentElement())==t}):W?(y=i,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=y;var Y=y(),x=e.createNativeRange(document),O=S.getBody(document),L=b.areHostObjects(Y,["anchorNode","focusNode"]&&b.areHostProperties(Y,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=L;var D=b.isHostMethod(Y,"extend");e.features.selectionHasExtend=D;var j="number"==typeof Y.rangeCount;e.features.selectionHasRangeCount=j;var z=!1,Q=!0;b.areHostMethods(Y,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof Y.rangeCount&&e.features.implementsDomRange&&!function(){var e=document.createElement("iframe");e.frameBorder=0,e.style.position="absolute",e.style.left="-10000px",O.appendChild(e);var t=S.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var i=S.getIframeWindow(e).getSelection(),n=t.documentElement,o=n.lastChild,r=o.firstChild,s=t.createRange();s.setStart(r,1),s.collapse(!0),i.addRange(s),Q=1==i.rangeCount,i.removeAllRanges();var a=s.cloneRange();s.setStart(r,0),a.setEnd(r,2),i.addRange(s),i.addRange(a),z=2==i.rangeCount,s.detach(),a.detach(),O.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=z,e.features.collapsedNonEditableSelectionsSupported=Q;var H,k=!1;O&&b.isHostMethod(O,"createControlRange")&&(H=O.createControlRange(),b.areHostProperties(H,["item","add"])&&(k=!0)),e.features.implementsControlRange=k,v=L?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var P;b.isHostMethod(Y,"getRangeAt")?P=function(e,t){try{return e.getRangeAt(t)}catch(i){return null}}:L&&(P=function(t){var i=S.getDocument(t.anchorNode),n=e.createRange(i);return n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(t.focusNode,t.focusOffset),n.setEnd(t.anchorNode,t.anchorOffset)),n}),e.getSelection=function(e){e=e||window;var t=e[C],i=y(e),o=R?n(e):null;return t?(t.nativeSelection=i,t.docSelection=o,t.refresh(e)):(t=new f(i,o,e),e[C]=t),t},e.getIframeSelection=function(t){return e.getSelection(S.getIframeWindow(t))};var B=f.prototype;if(!A&&L&&b.areHostMethods(Y,["removeAllRanges","addRange"])){B.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)};var $=function(t,i){var n=N.getRangeDocument(i),o=e.createRange(n);o.collapseToPoint(i.endContainer,i.endOffset),t.nativeSelection.addRange(a(o)),t.nativeSelection.extend(i.startContainer,i.startOffset),t.refresh()};j?B.addRange=function(t,i){if(k&&R&&this.docSelection.type==I)p(this,t);else if(i&&D)$(this,t);else{var n;if(z?n=this.rangeCount:(this.removeAllRanges(),n=0),this.nativeSelection.addRange(a(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==n+1){if(e.config.checkSelectionRanges){var r=P(this.nativeSelection,this.rangeCount-1);r&&!N.rangesEqual(r,t)&&(t=new E(r))}this._ranges[this.rangeCount-1]=t,o(this,t,K(this.nativeSelection)),this.isCollapsed=v(this)}else this.refresh()}}:B.addRange=function(e,t){t&&D?$(this,e):(this.nativeSelection.addRange(a(e)),this.refresh())},B.setRanges=function(e){if(k&&e.length>1)m(this,e);else{this.removeAllRanges();for(var t=0,i=e.length;i>t;++t)this.addRange(e[t])}}}else{if(!(b.isHostMethod(Y,"empty")&&b.isHostMethod(x,"select")&&k&&A))return t.fail("No means of selecting a Range or TextRange was found"),!1;B.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=S.getDocument(this.anchorNode);else if(this.docSelection.type==I){var t=this.docSelection.createRange();t.length&&(e=S.getDocument(t.item(0)).body.createTextRange())}if(e){var i=e.body.createTextRange();i.select(),this.docSelection.empty()}}}catch(n){}s(this)},B.addRange=function(e){this.docSelection.type==I?p(this,e):(E.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,o(this,e,!1))},B.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?m(this,e):t&&this.addRange(e[0])}}B.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new M("INDEX_SIZE_ERR");return this._ranges[e]};var U;if(A)U=function(t){var i;e.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=S.getBody(t.win.document).createTextRange(),i.collapse(!0)),t.docSelection.type==I?h(t):c(i)?u(t,i):s(t)};else if(b.isHostMethod(Y,"getRangeAt")&&"number"==typeof Y.rangeCount)U=function(t){if(k&&R&&t.docSelection.type==I)h(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,n=t.rangeCount;n>i;++i)t._ranges[i]=new e.WrappedRange(t.nativeSelection.getRangeAt(i));o(t,t._ranges[t.rangeCount-1],K(t.nativeSelection)),t.isCollapsed=v(t)}else s(t)};else{if(!L||typeof Y.isCollapsed!=w||typeof x.collapsed!=w||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;U=function(e){var t,i=e.nativeSelection;i.anchorNode?(t=P(i,0),e._ranges=[t],e.rangeCount=1,r(e),e.isCollapsed=v(e)):s(e)}}B.refresh=function(e){var t=e?this._ranges.slice(0):null;if(U(this),e){var i=t.length;if(i!=this._ranges.length)return!1;for(;i--;)if(!N.rangesEqual(t[i],this._ranges[i]))return!1;return!0}};var F=function(e,t){var i=e.getAllRanges(),n=!1;e.removeAllRanges();for(var o=0,r=i.length;r>o;++o)n||t!==i[o]?e.addRange(i[o]):n=!0;e.rangeCount||s(e)};k?B.removeRange=function(e){if(this.docSelection.type==I){for(var t,i=this.docSelection.createRange(),n=d(e),o=S.getDocument(i.item(0)),r=S.getBody(o).createControlRange(),s=!1,a=0,l=i.length;l>a;++a)t=i.item(a),t!==n||s?r.add(i.item(a)):s=!0;r.select(),h(this)}else F(this,e)}:B.removeRange=function(e){F(this,e)};var K;!A&&L&&e.features.implementsDomRange?(K=function(e){var t=!1;return e.anchorNode&&(t=1==S.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},B.isBackwards=function(){return K(this)}):K=B.isBackwards=function(){return!1},B.toString=function(){for(var e=[],t=0,i=this.rangeCount;i>t;++t)e[t]=""+this._ranges[t];return e.join("")},B.collapse=function(t,i){_(this,t);var n=e.createRange(S.getDocument(t));n.collapseToPoint(t,i),this.removeAllRanges(),this.addRange(n),this.isCollapsed=!0},B.collapseToStart=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},B.collapseToEnd=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},B.selectAllChildren=function(t){_(this,t);var i=e.createRange(S.getDocument(t));i.selectNodeContents(t),this.removeAllRanges(),this.addRange(i)},B.deleteFromDocument=function(){if(k&&R&&this.docSelection.type==I){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var i=this.getAllRanges();this.removeAllRanges();for(var n=0,o=i.length;o>n;++n)i[n].deleteContents();this.addRange(i[o-1])}},B.getAllRanges=function(){return this._ranges.slice(0)},B.setSingleRange=function(e){this.setRanges([e])},B.containsNode=function(e,t){for(var i=0,n=this._ranges.length;n>i;++i)if(this._ranges[i].containsNode(e,t))return!0;return!1},B.toHtml=function(){var e="";if(this.rangeCount){for(var t=N.getRangeDocument(this._ranges[0]).createElement("div"),i=0,n=this._ranges.length;n>i;++i)t.appendChild(this._ranges[i].cloneContents());e=t.innerHTML}return e},B.getName=function(){return"WrappedSelection"},B.inspect=function(){return g(this)},B.detach=function(){this.win[C]=null,this.win=this.anchorNode=this.focusNode=null},f.inspect=g,e.Selection=f,e.selectionPrototype=B,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),rangy.createModule("CssClassApplier",function(e,t){function i(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function n(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)}function o(e,t){e.className?n(e,t)||(e.className+=" "+t):e.className=t}function r(e){return e.split(/\s+/).sort().join(" ")}function s(e){return r(e.className)}function a(e,t){return s(e)==s(t)}function l(e){for(var t=e.parentNode;e.hasChildNodes();)t.insertBefore(e.firstChild,e);t.removeChild(e)}function d(e,t){var i=e.cloneRange();i.selectNodeContents(t);var n=i.intersection(e),o=n?n.toString():"";return i.detach(),""!=o}function c(e){return e.getNodes([3],function(t){return d(e,t)})}function u(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var i,n,o,r=0,s=e.attributes.length;s>r;++r)if(i=e.attributes[r],o=i.name,"class"!=o){if(n=t.attributes.getNamedItem(o),i.specified!=n.specified)return!1;if(i.specified&&i.nodeValue!==n.nodeValue)return!1}return!0}function h(e,t){for(var i,n=0,o=e.attributes.length;o>n;++n)if(i=e.attributes[n].name,(!t||!M.arrayContains(t,i))&&e.attributes[n].specified&&"class"!=i)return!0;return!1}function p(e,t){for(var i in t)if(t.hasOwnProperty(i)&&e[i]!==t[i])return!1;return!0}function f(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||W(e)&&!W(e.parentNode))}function m(e){return(W(e)||1!=e.nodeType&&W(e.parentNode))&&!f(e)}function _(e){return e&&1==e.nodeType&&!R.test(E(e,"display"))}function g(e){if(0==e.data.length)return!0;if(A.test(e.data))return!1;var t=E(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return _(e.previousSibling)||_(e.nextSibling)}function y(e,t){return M.isCharacterDataNode(e)?0==t?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function v(e,i,n,o){var r,s=0==n;if(M.isAncestorOf(i,e))return e;if(M.isCharacterDataNode(i))if(0==n)n=M.getNodeIndex(i),i=i.parentNode;else{if(n!=i.length)throw t.createError("splitNodeAt should not be called with offset in the middle of a data node ("+n+" in "+i.data);n=M.getNodeIndex(i)+1,i=i.parentNode}if(y(i,n)){if(!r){r=i.cloneNode(!1),r.id&&r.removeAttribute("id");for(var a;a=i.childNodes[n];)r.appendChild(a);M.insertAfter(r,i)}return i==e?r:v(e,r.parentNode,M.getNodeIndex(r),o)}if(e!=i){r=i.parentNode;var l=M.getNodeIndex(i);return s||l++,v(e,r,l,o)}return e}function w(e,t){return e.tagName==t.tagName&&a(e,t)&&u(e,t)}function C(e){var t=e?"nextSibling":"previousSibling";return function(i,n){var o=i.parentNode,r=i[t];if(r){if(r&&3==r.nodeType)return r}else if(n&&(r=o[t],r&&1==r.nodeType&&w(o,r)))return r[e?"firstChild":"lastChild"];return null}}function S(e){this.isElementMerge=1==e.nodeType,this.firstTextNode=this.isElementMerge?e.lastChild:e,this.textNodes=[this.firstTextNode]}function b(e,t,n){this.cssClass=e;var o,s,a,l,d=null;if("object"==typeof t&&null!==t){for(n=t.tagNames,d=t.elementProperties,s=0;l=O[s++];)t.hasOwnProperty(l)&&(this[l]=t[l]);o=t.normalize}else o=t;this.normalize="undefined"==typeof o?!0:o,this.attrExceptions=[];var c=document.createElement(this.elementTagName);this.elementProperties={};for(var u in d)d.hasOwnProperty(u)&&(L.hasOwnProperty(u)&&(u=L[u]),c[u]=d[u],this.elementProperties[u]=c[u],this.attrExceptions.push(u));this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?r(this.elementProperties.className+" "+e):e,this.applyToAnyTagName=!1;var h=typeof n;if("string"==h)"*"==n?this.applyToAnyTagName=!0:this.tagNames=i(n.toLowerCase()).split(/\s*,\s*/);else if("object"==h&&"number"==typeof n.length)for(this.tagNames=[],s=0,a=n.length;a>s;++s)"*"==n[s]?this.applyToAnyTagName=!0:this.tagNames.push(n[s].toLowerCase());else this.tagNames=[this.elementTagName]}function N(e,t,i){return new b(e,t,i)}e.requireModules(["WrappedSelection","WrappedRange"]);var E,M=e.dom,T="span",I=function(){function e(e,t,i){return t&&i?" ":""}return function(t,i){t.className&&(t.className=t.className.replace(new RegExp("(?:^|\\s)"+i+"(?:\\s|$)"),e))}}();"undefined"!=typeof window.getComputedStyle?E=function(e,t){return M.getWindow(e).getComputedStyle(e,null)[t]}:"undefined"!=typeof document.documentElement.currentStyle?E=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found");var W;!function(){var e=document.createElement("div");W="boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return e&&1==e.nodeType&&"false"!=e.contentEditable?"true"==e.contentEditable||W(e.parentNode):!1}}();var R=/^inline(-block|-table)?$/i,A=/[^\r\n\t\f \u200B]/,Y=C(!1),x=C(!0);S.prototype={doMerge:function(){for(var e,t,i,n=[],o=0,r=this.textNodes.length;r>o;++o)e=this.textNodes[o],t=e.parentNode,n[o]=e.data,o&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=i=n.join(""),i},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,i=this.textNodes.length;i>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}};var O=["elementTagName","ignoreWhiteSpace","applyToEditableOnly"],L={"class":"className"};b.prototype={elementTagName:T,elementProperties:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,hasClass:function(e){return 1==e.nodeType&&M.arrayContains(this.tagNames,e.tagName.toLowerCase())&&n(e,this.cssClass)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e,this.cssClass))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||m(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&g(e)},postApply:function(e,t,i){for(var n,o,r,s=e[0],a=e[e.length-1],l=[],d=s,c=a,u=0,h=a.length,p=0,f=e.length;f>p;++p)o=e[p],r=Y(o,!i),r?(n||(n=new S(r),l.push(n)),n.textNodes.push(o),o===s&&(d=n.firstTextNode,u=d.length),o===a&&(c=n.firstTextNode,h=n.getLength())):n=null;var m=x(a,!i);if(m&&(n||(n=new S(a),l.push(n)),n.textNodes.push(m)),l.length){for(p=0,f=l.length;f>p;++p)l[p].doMerge();t.setStart(d,u),t.setEnd(c,h)}},createContainer:function(t){var i=t.createElement(this.elementTagName);return e.util.extend(i,this.elementProperties),o(i,this.cssClass),i},applyToTextNode:function(e){var t=e.parentNode;if(1==t.childNodes.length&&M.arrayContains(this.tagNames,t.tagName.toLowerCase()))o(t,this.cssClass);else{var i=this.createContainer(M.getDocument(e));e.parentNode.insertBefore(i,e),i.appendChild(e)}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&s(e)==this.elementSortedClassName&&p(e,this.elementProperties)&&!h(e,this.attrExceptions)&&this.isModifiable(e)},undoToTextNode:function(e,t,i){if(!t.containsNode(i)){var n=t.cloneRange();n.selectNode(i),n.isPointInRange(t.endContainer,t.endOffset)&&(v(i,t.endContainer,t.endOffset,[t]),t.setEndAfter(i)),n.isPointInRange(t.startContainer,t.startOffset)&&(i=v(i,t.startContainer,t.startOffset,[t]))}this.isRemovable(i)?l(i):I(i,this.cssClass)},applyToRange:function(e){e.splitBoundaries();var t=c(e);if(t.length){for(var i,n=0,o=t.length;o>n;++n)i=t[n],this.isIgnorableWhiteSpaceNode(i)||this.getSelfOrAncestorWithClass(i)||!this.isModifiable(i)||this.applyToTextNode(i);e.setStart(t[0],0),i=t[t.length-1],e.setEnd(i,i.length),this.normalize&&this.postApply(t,e,!1)}},applyToSelection:function(t){t=t||window;var i,n=e.getSelection(t),o=n.getAllRanges();n.removeAllRanges();for(var r=o.length;r--;)i=o[r],this.applyToRange(i),n.addRange(i)},undoToRange:function(e){e.splitBoundaries();var t,i,n=c(e),o=n[n.length-1];if(n.length){for(var r=0,s=n.length;s>r;++r)t=n[r],i=this.getSelfOrAncestorWithClass(t),i&&this.isModifiable(t)&&this.undoToTextNode(t,e,i),e.setStart(n[0],0),e.setEnd(o,o.length);this.normalize&&this.postApply(n,e,!0)}},undoToSelection:function(t){t=t||window;var i,n=e.getSelection(t),o=n.getAllRanges();n.removeAllRanges();for(var r=0,s=o.length;s>r;++r)i=o[r],this.undoToRange(i),n.addRange(i)},getTextSelectedByRange:function(e,t){var i=t.cloneRange();i.selectNodeContents(e);var n=i.intersection(t),o=n?n.toString():"";return i.detach(),o},isAppliedToRange:function(e){if(e.collapsed)return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);for(var t,i=e.getNodes([3]),n=0;t=i[n++];)if(!this.isIgnorableWhiteSpaceNode(t)&&d(e,t)&&this.isModifiable(t)&&!this.getSelfOrAncestorWithClass(t))return!1;return!0},isAppliedToSelection:function(t){t=t||window;for(var i=e.getSelection(t),n=i.getAllRanges(),o=n.length;o--;)if(!this.isAppliedToRange(n[o]))return!1;return!0},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},detach:function(){}},b.util={hasClass:n,addClass:o,removeClass:I,hasSameClasses:a,replaceWithOwnChildren:l,elementsHaveSameNonClassAttributes:u,elementHasNonClassAttributes:h,splitNodeAt:v,isEditableElement:W,isEditingHost:f,isEditable:m},e.CssClassApplier=b,e.createCssClassApplier=N}),rangy.createModule("SaveRestore",function(e,t){function i(e,t){return(t||document).getElementById(e)}function n(e,t){var i,n="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=c.getDocument(e.startContainer),r=e.cloneRange();return r.collapse(t),i=o.createElement("span"),i.id=n,i.style.lineHeight="0",i.style.display="none",i.className="rangySelectionBoundary",i.appendChild(o.createTextNode(u)),r.insertNode(i),r.detach(),i}function o(e,n,o,r){var s=i(o,e);s?(n[r?"setStartBefore":"setEndBefore"](s),s.parentNode.removeChild(s)):t.warn("Marker element has been removed. Cannot restore selection.")}function r(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function s(o){o=o||window;var s=o.document;if(!e.isSelectionValid(o))return void t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");var a,l,d,c=e.getSelection(o),u=c.getAllRanges(),h=[];u.sort(r);for(var p=0,f=u.length;f>p;++p)d=u[p],d.collapsed?(l=n(d,!1),h.push({markerId:l.id,collapsed:!0})):(l=n(d,!1),a=n(d,!0),h[p]={startMarkerId:a.id,endMarkerId:l.id,collapsed:!1,backwards:1==u.length&&c.isBackwards()});for(p=f-1;p>=0;--p)d=u[p],d.collapsed?d.collapseBefore(i(h[p].markerId,s)):(d.setEndBefore(i(h[p].endMarkerId,s)),d.setStartAfter(i(h[p].startMarkerId,s)));return c.setRanges(u),{win:o,doc:s,rangeInfos:h,restored:!1}}function a(n,r){if(!n.restored){for(var s,a,l=n.rangeInfos,d=e.getSelection(n.win),c=[],u=l.length,h=u-1;h>=0;--h){if(s=l[h],a=e.createRange(n.doc),s.collapsed){var p=i(s.markerId,n.doc);if(p){p.style.display="inline";var f=p.previousSibling;f&&3==f.nodeType?(p.parentNode.removeChild(p),a.collapseToPoint(f,f.length)):(a.collapseBefore(p),p.parentNode.removeChild(p))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(n.doc,a,s.startMarkerId,!0),o(n.doc,a,s.endMarkerId,!1);1==u&&a.normalizeBoundaries(),c[h]=a}1==u&&r&&e.features.selectionHasExtend&&l[0].backwards?(d.removeAllRanges(),d.addRange(c[0],!0)):d.setRanges(c),n.restored=!0}}function l(e,t){var n=i(t,e);n&&n.parentNode.removeChild(n)}function d(e){for(var t,i=e.rangeInfos,n=0,o=i.length;o>n;++n)t=i[n],t.collapsed?l(e.doc,t.markerId):(l(e.doc,t.startMarkerId),l(e.doc,t.endMarkerId))}e.requireModules(["DomUtil","DomRange","WrappedRange"]);var c=e.dom,u="\ufeff";e.saveSelection=s,e.restoreSelection=a,e.removeMarkerElement=l,e.removeMarkers=d}),rangy.createModule("Serializer",function(e,t){function i(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function n(e,t){t=t||[];var o=e.nodeType,r=e.childNodes,s=r.length,a=[o,e.nodeName,s].join(":"),l="",d="";switch(o){case 3:l=i(e.nodeValue);break;case 8:l="<!--"+i(e.nodeValue)+"-->";break;default:l="<"+a+">",d="</>"}l&&t.push(l);for(var c=0;s>c;++c)n(r[c],t);return d&&t.push(d),t}function o(e){var t=n(e).join("");return g(t).toString(16)}function r(e,t,i){var n=[],o=e;for(i=i||y.getDocument(e).documentElement;o&&o!=i;)n.push(y.getNodeIndex(o,!0)),o=o.parentNode;return n.join("/")+":"+t}function s(e,i,n){i?n=n||y.getDocument(i):(n=n||document,i=n.documentElement);for(var o,r=e.split(":"),s=i,a=r[0]?r[0].split("/"):[],l=a.length;l--;){if(o=parseInt(a[l],10),!(o<s.childNodes.length))throw t.createError("deserializePosition failed: node "+y.inspectNode(s)+" has no child with index "+o+", "+l);s=s.childNodes[parseInt(a[l],10)]}return new y.DomPosition(s,parseInt(r[1],10))}function a(t,i,n){if(n=n||e.DomRange.getRangeDocument(t).documentElement,!y.isAncestorOf(n,t.commonAncestorContainer,!0))throw new Error("serializeRange: range is not wholly contained within specified root node");var s=r(t.startContainer,t.startOffset,n)+","+r(t.endContainer,t.endOffset,n);return i||(s+="{"+o(n)+"}"),s}function l(t,i,n){i?n=n||y.getDocument(i):(n=n||document,i=n.documentElement);var r=/^([^,]+),([^,\{]+)({([^}]+)})?$/.exec(t),a=r[4],l=o(i);if(a&&a!==o(i))throw new Error("deserializeRange: checksums of serialized range root node ("+a+") and target root node ("+l+") do not match");var d=s(r[1],i,n),c=s(r[2],i,n),u=e.createRange(n);return u.setStart(d.node,d.offset),u.setEnd(c.node,c.offset),u}function d(e,t,i){t?i=i||y.getDocument(t):(i=i||document,t=i.documentElement);var n=/^([^,]+),([^,]+)({([^}]+)})?$/.exec(e),r=n[3];return!r||r===o(t)}function c(t,i,n){t=t||e.getSelection();for(var o=t.getAllRanges(),r=[],s=0,l=o.length;l>s;++s)r[s]=a(o[s],i,n);return r.join("|")}function u(t,i,n){i?n=n||y.getWindow(i):(n=n||window,i=n.document.documentElement);for(var o=t.split("|"),r=e.getSelection(n),s=[],a=0,d=o.length;d>a;++a)s[a]=l(o[a],i,n.document);return r.setRanges(s),r}function h(e,t,i){var n;t?n=i?i.document:y.getDocument(t):(i=i||window,t=i.document.documentElement);for(var o=e.split("|"),r=0,s=o.length;s>r;++r)if(!d(o[r],t,n))return!1;return!0}function p(e){for(var t,i,n=e.split(/[;,]/),o=0,r=n.length;r>o;++o)if(t=n[o].split("="),t[0].replace(/^\s+/,"")==v&&(i=t[1]))return decodeURIComponent(i.replace(/\s+$/,""));return null}function f(e){e=e||window;var t=p(e.document.cookie);t&&u(t,e.doc)}function m(t,i){t=t||window,i="object"==typeof i?i:{};var n=i.expires?";expires="+i.expires.toUTCString():"",o=i.path?";path="+i.path:"",r=i.domain?";domain="+i.domain:"",s=i.secure?";secure":"",a=c(e.getSelection(t));t.document.cookie=encodeURIComponent(v)+"="+encodeURIComponent(a)+n+o+r+s}e.requireModules(["WrappedSelection","WrappedRange"]);var _="undefined";(typeof encodeURIComponent==_||typeof decodeURIComponent==_)&&t.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method");var g=function(){function e(e){for(var t,i=[],n=0,o=e.length;o>n;++n)t=e.charCodeAt(n),128>t?i.push(t):2048>t?i.push(t>>6|192,63&t|128):i.push(t>>12|224,t>>6&63|128,63&t|128);return i}function t(){for(var e,t,i=[],n=0;256>n;++n){for(t=n,e=8;e--;)1==(1&t)?t=t>>>1^3988292384:t>>>=1;i[n]=t>>>0}return i}function i(){return n||(n=t()),n}var n=null;return function(t){for(var n,o=e(t),r=-1,s=i(),a=0,l=o.length;l>a;++a)n=255&(r^o[a]),r=r>>>8^s[n];return(-1^r)>>>0}}(),y=e.dom,v="rangySerializedSelection";e.serializePosition=r,e.deserializePosition=s,e.serializeRange=a,e.deserializeRange=l,e.canDeserializeRange=d,e.serializeSelection=c,e.deserializeSelection=u,e.canDeserializeSelection=h,e.restoreSelectionFromCookie=f,e.saveSelectionCookie=m,e.getElementChecksum=o}),"undefined"==typeof WYMeditor)var WYMeditor={};!function(){if("undefined"==typeof window.console&&"undefined"==typeof console){var e,t=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],i=function(){};for(WYMeditor.console={},e=0;e<t.length;e+=1)WYMeditor.console[t[e]]=i}else"undefined"!=typeof console?WYMeditor.console=console:window.console.firebug?WYMeditor.console=window.console:window.console&&(WYMeditor.console=window.console)}(),jQuery.extend(WYMeditor,{VERSION:"@@VERSION",INSTANCES:[],STRINGS:[],SKINS:[],CUSTOM_COMMANDS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",WYM_PATH:"{Wym_Wym_Path}",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",NEWLINE:"\n",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TR:"tr",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",REL:"rel",ALT:"alt",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote"],FORBIDDEN_MAIN_CONTAINERS:["strong","b","em","i","sub","sup","a","span"],BLOCKS:["address","blockquote","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","noscript","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr"],BLOCKING_ELEMENTS:["table","blockquote","pre"],NON_BLOCKING_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6"],LIST_TYPE_ELEMENTS:["ul","ol"],HEADING_ELEMENTS:["h1","h2","h3","h4","h5","h6"],POTENTIAL_LIST_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","td"],POTENTIAL_TABLE_INSERT_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","li"],INLINE_TABLE_INSERTION_ELEMENTS:["li"],SELECTABLE_TABLE_ELEMENTS:["td","th","caption"],BLOCKING_ELEMENT_SPACER_CLASS:"wym-blocking-element-spacer",EDITOR_ONLY_CLASS:"wym-editor-only",CLASSES_REMOVED_BY_PARSER:["apple-style-span"],KEY:{BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,END:35,HOME:36,CURSOR:[37,38,39,40],LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,B:66,I:73,R:82,COMMAND:224},POTENTIAL_BLOCK_ELEMENT_CREATION_KEYS:[8,13,37,38,39,40,46],EVENTS:{postIframeInitialization:"wym-postIframeInitialization",postBlockMaybeCreated:"wym-postBlockMaybeCreated",documentHTMLUpdated:"wym-documentHTMLUpdated"},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(e,t){this._index=WYMeditor.INSTANCES.push(this)-1,this._element=e,this._options=t,this._options.html||(this._options.html=jQuery(e).val()),this._options.wymPath=this._options.wymPath||WYMeditor.computeWymPath(),this._options.basePath=this._options.basePath||WYMeditor.computeBasePath(this._options.wymPath),this._options.jQueryPath=this._options.jQueryPath||WYMeditor.computeJqueryPath(),this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT,this.init()}}),jQuery.fn.wymeditor=function(e){return e=jQuery.extend({html:"",basePath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,skin:"default",lang:"en",direction:"ltr",customCommands:[],structureRules:{defaultRootContainer:"p"},boxHtml:String()+"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div><div class='wym_area_left'></div><div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div><div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div><div class='wym_area_bottom'>"+WYMeditor.LOGO+"</div></div>",logoHtml:String()+'<a class="wym_wymeditor_link" href="http://www.wymeditor.org/">WYMeditor</a>',iframeHtml:String()+'<div class="wym_iframe wym_section"><iframe src="'+WYMeditor.IFRAME_BASE_PATH+'wymiframe.html"></iframe></div>',toolsHtml:String()+'<div class="wym_tools wym_section"><h2>{Tools}</h2><ul>'+WYMeditor.TOOLS_ITEMS+"</ul></div>",toolsItemHtml:String()+'<li class="'+WYMeditor.TOOL_CLASS+'"><a href="#" name="'+WYMeditor.TOOL_NAME+'" title="'+WYMeditor.TOOL_TITLE+'">'+WYMeditor.TOOL_TITLE+"</a></li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",title:"Preview",css:"wym_tools_preview"}],containersHtml:String()+'<div class="wym_containers wym_section"><h2>{Containers}</h2><ul>'+WYMeditor.CONTAINERS_ITEMS+"</ul></div>",containersItemHtml:String()+'<li class="'+WYMeditor.CONTAINER_CLASS+'"><a href="#" name="'+WYMeditor.CONTAINER_NAME+'">'+WYMeditor.CONTAINER_TITLE+"</a></li>",containersItems:[{name:"P",title:"Paragraph",css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",css:"wym_containers_th"}],classesHtml:String()+'<div class="wym_classes wym_section"><h2>{Classes}</h2><ul>'+WYMeditor.CLASSES_ITEMS+"</ul></div>",classesItemHtml:String()+'<li class="wym_classes_'+WYMeditor.CLASS_NAME+'"><a href="#" name="'+WYMeditor.CLASS_NAME+'">'+WYMeditor.CLASS_TITLE+"</a></li>",classesItems:[],statusHtml:String()+'<div class="wym_status wym_section"><h2>{Status}</h2></div>',htmlHtml:String()+'<div class="wym_html wym_section"><h2>{Source_Code}</h2><textarea class="wym_html_val"></textarea></div>',boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",relSelector:".wym_rel",altSelector:".wym_alt",textSelector:".wym_text",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",summarySelector:".wym_summary",
submitSelector:"form",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:"menubar=no,titlebar=no,toolbar=no,resizable=no,width=560,height=300,top=0,left=0",dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",dialogHtml:String()+'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html dir="'+WYMeditor.DIRECTION+'"><head><title>'+WYMeditor.DIALOG_TITLE+'</title><script type="text/javascript" src="'+WYMeditor.JQUERY_PATH+'"></script><script type="text/javascript" src="'+WYMeditor.WYM_PATH+'"></script></head>'+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:String()+'<body class="wym_dialog wym_dialog_link"  onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_LINK+'" /><legend>{Link}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_href" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row"><label>{Relationship}</label><input type="text" class="wym_rel" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogImageHtml:String()+'<body class="wym_dialog wym_dialog_image" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_IMAGE+'" /><legend>{Image}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_src" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Alternative_Text}</label><input type="text" class="wym_alt" value="" size="40" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogTableHtml:String()+'<body class="wym_dialog wym_dialog_table" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_TABLE+'" /><legend>{Table}</legend><div class="row"><label>{Caption}</label><input type="text" class="wym_caption" value="" size="40" /></div><div class="row"><label>{Summary}</label><input type="text" class="wym_summary" value="" size="40" /></div><div class="row"><label>{Number_Of_Rows}</label><input type="text" class="wym_rows" value="3" size="3" /></div><div class="row"><label>{Number_Of_Cols}</label><input type="text" class="wym_cols" value="2" size="3" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogPasteHtml:String()+'<body class="wym_dialog wym_dialog_paste" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_PASTE+'" /><fieldset><legend>{Paste_From_Word}</legend><div class="row"><textarea class="wym_text" rows="10" cols="50" autofocus="autofocus"></textarea></div><div class="row"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogPreviewHtml:String()+'<body class="wym_dialog wym_dialog_preview" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"></body>',stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},e),this.each(function(){this._wym=new WYMeditor.editor(jQuery(this),e)})},jQuery.extend({wymeditors:function(e){return WYMeditor.INSTANCES[e]}}),WYMeditor.computeWymPath=function(){var e=jQuery(jQuery.grep(jQuery("script"),function(e){return e.src?e.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)||e.src.match(/\/core\.js(\?.*)?$/):null}));return e.length>0?e.attr("src"):(WYMeditor.console.warn("Error determining wymPath. No base WYMeditor file located."),WYMeditor.console.warn("Assuming wymPath to be the current URL"),WYMeditor.console.warn("Please pass a correct wymPath option"),"")},WYMeditor.computeBasePath=function(e){var t=e.lastIndexOf("/");return e.substr(0,t+1)},WYMeditor.computeJqueryPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(e){return e.src&&e.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.INIT_DIALOG=function(e){var t,i=window.opener.WYMeditor.INSTANCES[e],n=i.selected(),o=jQuery(i._options.dialogTypeSelector).val(),r=i.uniqueStamp();o===WYMeditor.DIALOG_LINK&&(n&&n.tagName&&n.tagName.toLowerCase!==WYMeditor.A&&(n=jQuery(n).parentsOrSelf(WYMeditor.A)),!n&&i._selectedImage&&(n=jQuery(i._selectedImage).parentsOrSelf(WYMeditor.A))),jQuery.isFunction(i._options.preInitDialog)&&i._options.preInitDialog(i,window),n&&(jQuery(i._options.hrefSelector).val(jQuery(n).attr(WYMeditor.HREF)),jQuery(i._options.srcSelector).val(jQuery(n).attr(WYMeditor.SRC)),jQuery(i._options.titleSelector).val(jQuery(n).attr(WYMeditor.TITLE)),jQuery(i._options.relSelector).val(jQuery(n).attr(WYMeditor.REL)),jQuery(i._options.altSelector).val(jQuery(n).attr(WYMeditor.ALT))),i._selectedImage&&(jQuery(i._options.dialogImageSelector+" "+i._options.srcSelector).val(jQuery(i._selectedImage).attr(WYMeditor.SRC)),jQuery(i._options.dialogImageSelector+" "+i._options.titleSelector).val(jQuery(i._selectedImage).attr(WYMeditor.TITLE)),jQuery(i._options.dialogImageSelector+" "+i._options.altSelector).val(jQuery(i._selectedImage).attr(WYMeditor.ALT))),jQuery(i._options.dialogLinkSelector+" "+i._options.submitSelector).submit(function(){var e,t=jQuery(i._options.hrefSelector).val();t.length>0&&(n[0]&&n[0].tagName.toLowerCase()===WYMeditor.A?e=n:(i._exec(WYMeditor.CREATE_LINK,r),e=jQuery("a[href="+r+"]",i._doc.body)),e.attr(WYMeditor.HREF,t),e.attr(WYMeditor.TITLE,jQuery(i._options.titleSelector).val()),e.attr(WYMeditor.REL,jQuery(i._options.relSelector).val())),window.close()}),jQuery(i._options.dialogImageSelector+" "+i._options.submitSelector).submit(function(){var e,t=jQuery(i._options.srcSelector).val();t.length>0&&(i._exec(WYMeditor.INSERT_IMAGE,r),e=jQuery("img[src$="+r+"]",i._doc.body),e.attr(WYMeditor.SRC,t),e.attr(WYMeditor.TITLE,jQuery(i._options.titleSelector).val()),e.attr(WYMeditor.ALT,jQuery(i._options.altSelector).val())),window.close()}),t=WYMeditor.MAKE_TABLE_ONCLICK(i),jQuery(i._options.dialogTableSelector+" "+i._options.submitSelector).submit(t),jQuery(i._options.dialogPasteSelector+" "+i._options.submitSelector).submit(function(){var e=jQuery(i._options.textSelector).val();i.paste(e),window.close()}),jQuery(i._options.dialogPreviewSelector+" "+i._options.previewSelector).html(i.xhtml()),jQuery(i._options.cancelSelector).mousedown(function(){window.close()}),jQuery.isFunction(i._options.postInitDialog)&&i._options.postInitDialog(i,window)},WYMeditor.MAKE_TABLE_ONCLICK=function(e){var t=function(){var t=jQuery(e._options.rowsSelector).val(),i=jQuery(e._options.colsSelector).val(),n=jQuery(e._options.captionSelector).val(),o=jQuery(e._options.summarySelector).val();e.insertTable(t,i,n,o),window.close()};return t},jQuery.fn.isPhantomNode=function(){return 3===this[0].nodeType?!/[^\t\n\r ]/.test(this[0].data):!1},jQuery.fn.nextContentsUntil=function(e,t){var i,n=[],o=this.get(0);if(e=e?e:"",t=t?t:"",!o)return jQuery();for(o=o.nextSibling;o&&!jQuery(o).is(e);)n.push(o),o=o.nextSibling;return i=jQuery(n),t?i.filter(t):i},jQuery.fn.nextAllContents=function(){return jQuery(this).nextContentsUntil("","")},jQuery.fn.prevContentsUntil=function(e,t){var i,n=[],o=this.get(0);if(e=e?e:"",t=t?t:"",!o)return jQuery();for(o=o.previousSibling;o&&!jQuery(o).is(e);)n.push(o),o=o.previousSibling;return i=jQuery(n),t?i.filter(t):i},jQuery.fn.prevAllContents=function(){return jQuery(this).prevContentsUntil("","")},WYMeditor.isPhantomNode=function(e){return 3===e.nodeType?!/[^\t\n\r ]/.test(e.data):!1},WYMeditor.isPhantomString=function(e){return!/[^\t\n\r ]/.test(e)},jQuery.fn.parentsOrSelf=function(e){var t=this;return 3===t[0].nodeType&&(t=t.parents().slice(0,1)),1===t.filter(e).size()?t:t.parents(e).slice(0,1)},WYMeditor.changeNodeType=function(e,t){var i,n,o=e.attributes;for(jQuery(e).wrapInner("<"+t+">"),i=jQuery(e).children().get(0),n=0;n<o.length;n++)o[n].specified&&i.setAttribute(o[n].nodeName,o[n].nodeValue);return jQuery(e).contents().unwrap(),i},WYMeditor.Helper={replaceAll:function(e,t,i){var n=new RegExp(t,"g");return e.replace(n,i)},insertAt:function(e,t,i){return e.substr(0,i)+t+e.substring(i)},trim:function(e){return jQuery.trim(e)},contains:function(e,t){var i;for(i=0;i<e.length;i+=1)if(e[i]===t)return!0;return!1},indexOf:function(e,t){var i,n=-1;for(i=0;i<e.length;i+=1)if(e[i]===t){n=i;break}return n},findByName:function(e,t){var i,n;for(i=0;i<e.length;i+=1)if(n=e[i],n.name===t)return n;return null}},WYMeditor.XmlHelper=function(){return this._entitiesDiv=document.createElement("div"),this},WYMeditor.XmlHelper.prototype.tag=function(e,t,i){return t=t||!1,i=i||!1,"<"+e+(t?this.tagOptions(t):"")+(i?">":" />")},WYMeditor.XmlHelper.prototype.contentTag=function(e,t,i){return i=i||!1,"<"+e+(i?this.tagOptions(i):"")+">"+t+"</"+e+">"},WYMeditor.XmlHelper.prototype.cdataSection=function(e){return"<![CDATA["+e+"]]>"},WYMeditor.XmlHelper.prototype.escapeOnce=function(e){return this._fixDoubleEscape(this.escapeEntities(e))},WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(e){return e.replace(/&amp;([a-z]+|(#\d+));/gi,"&$1;")},WYMeditor.XmlHelper.prototype.tagOptions=function(e){var t=this;t._formated_options="";for(var i in e){var n=e[i];"function"!=typeof n&&n.length>0&&(parseInt(i,10)==i&&"object"==typeof n&&(i=n.shift(),n=n.pop()),""!==i&&""!==n&&(t._formated_options+=" "+i+'="'+t.escapeOnce(n)+'"'))}return t._formated_options},WYMeditor.XmlHelper.prototype.escapeEntities=function(e,t){this._entitiesDiv.innerHTML=e,this._entitiesDiv.textContent=e;var i=this._entitiesDiv.innerHTML;return"undefined"==typeof t&&(t!==!1&&(i=i.replace('"',"&quot;")),t===!0&&(i=i.replace('"',"&#039;"))),i},WYMeditor.XmlHelper.prototype.parseAttributes=function(e){var t=[],i=e.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(i.toString()!=e)for(var n in i){var o=i[n];if("function"!=typeof o&&0!==o.length){var r=new RegExp("(\\w+)\\s*"+o),s=e.match(r);if(s){var a=o.replace(/^[\s=]+/,""),l=a.charAt(0);l='"'==l?'"':"'"==l?"'":"",""!==l&&(a='"'==l?a.replace(/^"|"+$/g,""):a.replace(/^'|'+$/g,"")),e=e.replace(s[0],""),t.push([s[1],a])}}}return t},WYMeditor.DocumentStructureManager=function(e,t){this._wym=e,this.structureRules=WYMeditor.DocumentStructureManager.DEFAULTS,this.setDefaultRootContainer(t)},jQuery.extend(WYMeditor.DocumentStructureManager,{VALID_DEFAULT_ROOT_CONTAINERS:["p","div"],DEFAULT_ROOT_CONTAINER_TITLES:{p:"Paragraph",div:"Division"},CONTAINERS_BLOCKING_NAVIGATION:["table","blockquote","pre"],DEFAULTS:{defaultRootContainer:"p",notValidRootContainers:["div"],validRootContainers:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","table","ol","ul"],convertIfRootContainers:["div"],validListConversionTargetContainers:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","td","th"],wrapContentsInList:["td","th"]}}),WYMeditor.DocumentStructureManager.prototype.setDefaultRootContainer=function(e){var t,i,n;if(this.structureRules.defaultRootContainer!==e){if(n=WYMeditor.DocumentStructureManager,t=n.VALID_DEFAULT_ROOT_CONTAINERS,i=jQuery.inArray(e,t),-1===i)throw new Error("a defaultRootContainer of '"+e+"' is not supported");this.structureRules.defaultRootContainer=e,this.structureRules.notValidRootContainers=WYMeditor.DocumentStructureManager.VALID_DEFAULT_ROOT_CONTAINERS,this.structureRules.notValidRootContainers.splice(i,1),this.adjustDefaultRootContainerUI()}},WYMeditor.DocumentStructureManager.prototype.adjustDefaultRootContainerUI=function(){var e,t,i,n,o,r,s,a,l=this._wym,d=this.structureRules.defaultRootContainer;for(e=jQuery(l._box).find(l._options.containersSelector).find("li"),o=!0,s=0;s<e.length;++s)t=e.eq(s).find("a"),n=t.attr("name").toLowerCase(),jQuery.inArray(n,this.structureRules.notValidRootContainers)>-1&&e.eq(s).remove(),n===d&&(o=!1);o&&(r=l._options.containersItemHtml,r=WYMeditor.Helper.replaceAll(r,WYMeditor.CONTAINER_NAME,d.toUpperCase()),a=WYMeditor.DocumentStructureManager,r=WYMeditor.Helper.replaceAll(r,WYMeditor.CONTAINER_TITLE,a.DEFAULT_ROOT_CONTAINER_TITLES[d]),r=WYMeditor.Helper.replaceAll(r,WYMeditor.CONTAINER_CLASS,"wym_containers_"+d),i=jQuery(r),e=jQuery(l._box).find(l._options.containersSelector).find("li"),e.eq(0).before(i),i.find("a").click(function(){return l.container(jQuery(this).attr(WYMeditor.NAME)),!1}))},WYMeditor.editor.prototype.init=function(){var WymClass=!1,SaxListener,prop,h,iframeHtml,boxHtml,aTools,sTools,oTool,sTool,i,aClasses,sClasses,oClass,sClass,aContainers,sContainers,sContainer,oContainer,wym;if(jQuery.browser.msie?WymClass=new WYMeditor.WymClassExplorer(this):jQuery.browser.mozilla?WymClass=new WYMeditor.WymClassMozilla(this):jQuery.browser.opera?WymClass=new WYMeditor.WymClassOpera(this):(jQuery.browser.safari||jQuery.browser.webkit||jQuery.browser.chrome)&&(WymClass=new WYMeditor.WymClassSafari(this)),WymClass!==!1){jQuery.isFunction(this._options.preInit)&&this._options.preInit(this),this.parser=null,this.helper=null,this._options.disable_sanitization||(SaxListener=new WYMeditor.XhtmlSaxListener,this.parser=new WYMeditor.XhtmlParser(SaxListener)),this.helper=new WYMeditor.XmlHelper;for(prop in WymClass)this[prop]=WymClass[prop];for(wym=this,wym._box=jQuery(wym._element).hide().after(wym._options.boxHtml).next().addClass("wym_box_"+wym._index),jQuery.isFunction(jQuery.fn.data)&&(jQuery.data(wym._box.get(0),WYMeditor.WYM_INDEX,wym._index),jQuery.data(wym._element.get(0),WYMeditor.WYM_INDEX,wym._index)),h=WYMeditor.Helper,iframeHtml=wym._options.iframeHtml,iframeHtml=h.replaceAll(iframeHtml,WYMeditor.INDEX,wym._index),iframeHtml=h.replaceAll(iframeHtml,WYMeditor.IFRAME_BASE_PATH,wym._options.iframeBasePath),boxHtml=jQuery(wym._box).html(),boxHtml=h.replaceAll(boxHtml,WYMeditor.LOGO,wym._options.logoHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS,wym._options.toolsHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS,wym._options.containersHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES,wym._options.classesHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.HTML,wym._options.htmlHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.IFRAME,iframeHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.STATUS,wym._options.statusHtml),aTools=eval(wym._options.toolsItems),sTools="",i=0;i<aTools.length;i+=1)oTool=aTools[i],oTool.html?sTool=oTool.html:(sTool="",oTool.name&&oTool.title&&(sTool=wym._options.toolsItemHtml),sTool=h.replaceAll(sTool,WYMeditor.TOOL_NAME,oTool.name),sTool=h.replaceAll(sTool,WYMeditor.TOOL_TITLE,wym._options.stringDelimiterLeft+oTool.title+wym._options.stringDelimiterRight),sTool=h.replaceAll(sTool,WYMeditor.TOOL_CLASS,oTool.css)),sTools+=sTool;for(boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS_ITEMS,sTools),aClasses=eval(wym._options.classesItems),sClasses="",i=0;i<aClasses.length;i+=1)oClass=aClasses[i],sClass="",oClass.name&&oClass.title&&(sClass=wym._options.classesItemHtml),sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,oClass.title),sClasses+=sClass;for(boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES_ITEMS,sClasses),aContainers=eval(wym._options.containersItems),sContainers="",i=0;i<aContainers.length;i+=1)oContainer=aContainers[i],sContainer="",oContainer.name&&oContainer.title&&(sContainer=wym._options.containersItemHtml),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_NAME,oContainer.name),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_TITLE,wym._options.stringDelimiterLeft+oContainer.title+wym._options.stringDelimiterRight),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_CLASS,oContainer.css),sContainers+=sContainer;boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS_ITEMS,sContainers),boxHtml=wym.replaceStrings(boxHtml),jQuery(wym._box).html(boxHtml),jQuery(wym._box).find(wym._options.htmlSelector).hide(),wym.documentStructureManager=new WYMeditor.DocumentStructureManager(wym,wym._options.structureRules.defaultRootContainer),wym._iframe_initialized=!1,jQuery(wym._box).find("iframe").load(function(){wym._iframe_initialized!==!0&&(wym._iframe_initialized=wym.initIframe(this))}),wym.initSkin()}},WYMeditor.editor.prototype.bindEvents=function(){var wym=this,$html_val;jQuery(this._box).find(this._options.toolSelector).click(function(e){wym._iframe.contentWindow.focus(),wym.exec(jQuery(this).attr(WYMeditor.NAME)),e.preventDefault()}),jQuery(this._box).find(this._options.containerSelector).click(function(e){wym.container(jQuery(this).attr(WYMeditor.NAME)),e.preventDefault()}),$html_val=jQuery(this._box).find(this._options.htmlValSelector),$html_val.keyup(function(){jQuery(wym._doc.body).html(jQuery(this).val())}),$html_val.focus(function(){jQuery(this).toggleClass("hasfocus")}),$html_val.blur(function(){jQuery(this).toggleClass("hasfocus")}),this._element.bind("change",function(){jQuery(wym._doc.body).html(jQuery(this).val())}),jQuery(this._box).find(this._options.classSelector).click(function(e){var aClasses=eval(wym._options.classesItems),sName=jQuery(this).attr(WYMeditor.NAME),oClass=WYMeditor.Helper.findByName(aClasses,sName),jqexpr;oClass&&(jqexpr=oClass.expr,wym.toggleClass(sName,jqexpr)),wym._iframe.contentWindow.focus(),e.preventDefault()}),jQuery(this._options.updateSelector).bind(this._options.updateEvent,function(){wym.update(!0)})},WYMeditor.editor.prototype.ready=function(){return null!==this._doc},WYMeditor.editor.prototype.box=function(){return this._box},WYMeditor.editor.prototype._html=function(e){return"string"!=typeof e?jQuery(this._doc.body).html():(jQuery(this._doc.body).html(e),void this.update())},WYMeditor.editor.prototype.html=function(e){return WYMeditor.console.warn("The function WYMeditor.editor.html() is deprecated. Use either WYMeditor.editor.xhtml() or WYMeditor.editor._html() instead."),"string"!=typeof e?this._html():void this._html(e)},WYMeditor.editor.prototype.xhtml=function(){return this._options.disable_sanitization?this._html():this.parser.parse(this._html())},WYMeditor.editor.prototype.exec=function(e,t){var i,n,o,r,s=this;switch(e){case WYMeditor.CREATE_LINK:i=this.container(),(i||this._selectedImage)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.UNLINK:if(this.selection&&this.selection_collapsed()&&(r=this.selected_parents_contains("a"),r.length)){r.each(function(){jQuery(this).replaceWith(this.childNodes)});break}this._exec(e);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(this.xhtml()),this.toggleHtml();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW,this._options.dialogFeaturesPreview);break;case WYMeditor.INSERT_ORDEREDLIST:this.insertOrderedlist();break;case WYMeditor.INSERT_UNORDEREDLIST:this.insertUnorderedlist();break;case WYMeditor.INDENT:this.indent();break;case WYMeditor.OUTDENT:this.outdent();break;default:o=jQuery.merge([],this._options.customCommands),jQuery.merge(o,WYMeditor.CUSTOM_COMMANDS),jQuery.each(o,function(){return e===this.name?(n=!0,this.run.apply(s,t),!1):void 0}),n||this._exec(e)}e!==WYMeditor.TOGGLE_HTML&&(this.update_selections(),this._element.trigger(WYMeditor.EVENTS.documentHTMLUpdated,[this,jQuery(this._doc.body).html()]))},WYMeditor.editor.prototype.selection=function(){window.rangy&&!rangy.initialized&&rangy.init();var e=this._iframe,t=rangy.getIframeSelection(e);return t},WYMeditor.editor.prototype.selected=function(){var e,t,i,n=this.selection(),o=n.focusNode;return o?(jQuery.browser.msie&&(t=o.tagName&&"body"===o.tagName.toLowerCase(),i="#text"===o.nodeName,n.isCollapsed&&(t||i)&&(e=this._iframe.contentWindow.document.caretPos,e&&e.parentElement&&(o=e.parentElement()))),"#text"===o.nodeName?o.parentNode:o):null},WYMeditor.editor.prototype.selection_collapsed=function(){var e=this.selection(),t=!1;return jQuery.each(e.getAllRanges(),function(){return this.collapsed?(t=!0,!1):void 0}),t},WYMeditor.editor.prototype.selected_contains=function(e){var t=this.selection(),i=[];return jQuery.each(t.getAllRanges(),function(){jQuery.each(this.getNodes(),function(){jQuery(this).is(e)&&i.push(this)})}),i},WYMeditor.editor.prototype.selected_parents_contains=function(e){var t=jQuery([]),i=jQuery(this.selected());return i.is(e)&&(t=t.add(i)),t=t.add(i.parents(e))},WYMeditor.editor.prototype.container=function(e){if("undefined"==typeof e)return this.selected();var t,i,n,o,r,s,a,l=null;if(e.toLowerCase()===WYMeditor.TH){switch(l=this.container(),l.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:t=[WYMeditor.TD,WYMeditor.TH],l=this.findUp(this.container(),t)}null!==l&&(e=WYMeditor.TD,l.tagName.toLowerCase()===WYMeditor.TD&&(e=WYMeditor.TH),this.switchTo(l,e,!1),this.update())}else if(t=[WYMeditor.P,WYMeditor.DIV,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE],l=this.findUp(this.container(),t)){if(e.toLowerCase()===WYMeditor.BLOCKQUOTE)if(n=this.findUp(this.container(),WYMeditor.BLOCKQUOTE),null===n)i=this._doc.createElement(e),l.parentNode.insertBefore(i,l),i.appendChild(l),this.setFocusToNode(i.firstChild);else{for(o=n.childNodes,r=o.length,r>0&&(s=o.item(0)),a=0;r>a;a+=1)n.parentNode.insertBefore(o.item(0),n);n.parentNode.removeChild(n),s&&this.setFocusToNode(s)}else this.switchTo(l,e);this.update()}return!1},WYMeditor.editor.prototype.isForbiddenMainContainer=function(e){return jQuery.inArray(e.toLowerCase(),WYMeditor.FORBIDDEN_MAIN_CONTAINERS)>-1},WYMeditor.editor.prototype.keyCanCreateBlockElement=function(e){return jQuery.inArray(e,WYMeditor.POTENTIAL_BLOCK_ELEMENT_CREATION_KEYS)>-1},WYMeditor.editor.prototype.toggleClass=function(e,t){var i=null;i=this._selectedImage?this._selectedImage:jQuery(this.selected()),i=jQuery(i).parentsOrSelf(t),jQuery(i).toggleClass(e),jQuery(i).attr(WYMeditor.CLASS)||jQuery(i).removeAttr(this._class)},WYMeditor.editor.prototype.findUp=function(e,t){if("undefined"==typeof e||null===e)return null;"#text"===e.nodeName&&(e=e.parentNode);var i,n,o=e.tagName.toLowerCase();if(typeof t===WYMeditor.STRING)for(;o!==t&&o!==WYMeditor.BODY;)e=e.parentNode,o=e.tagName.toLowerCase();else for(i=!1;!i&&o!==WYMeditor.BODY;){for(n=0;n<t.length;n+=1)if(o===t[n]){i=!0;break}if(!i){if(e=e.parentNode,null===e)return null;o=e.tagName.toLowerCase()}}return o===WYMeditor.BODY?null:e},WYMeditor.editor.prototype.switchTo=function(e,t,i){var n,o=this._doc.createElement(t),r=jQuery(e).html(),s=e.attributes;if(!i)for(n=0;n<s.length;++n)o.setAttribute(s.item(n).nodeName,s.item(n).nodeValue);o.innerHTML=r,e.parentNode.replaceChild(o,e),this.setFocusToNode(o)},WYMeditor.editor.prototype.replaceStrings=function(e){var t;if(!WYMeditor.STRINGS[this._options.lang])return WYMeditor.console.error("WYMeditor: language '"+this._options.lang+"' not found."),WYMeditor.console.error("Unable to perform i10n."),e;for(t in WYMeditor.STRINGS[this._options.lang])WYMeditor.STRINGS[this._options.lang].hasOwnProperty(t)&&(e=WYMeditor.Helper.replaceAll(e,this._options.stringDelimiterLeft+t+this._options.stringDelimiterRight,WYMeditor.STRINGS[this._options.lang][t]));return e},WYMeditor.editor.prototype.encloseString=function(e){return this._options.stringDelimiterLeft+e+this._options.stringDelimiterRight},WYMeditor.editor.prototype.status=function(e){jQuery(this._box).find(this._options.statusSelector).html(e)},WYMeditor.editor.prototype.update=function(e){var t;this._options.before_update&&e&&this._options.before_update.apply(this),t=this.xhtml(),jQuery(this._element).val(t),jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(t),this.fixBodyHtml()},WYMeditor.editor.prototype.fixBodyHtml=function(){var e=this;e.spaceBlockingElements(),e.fixDoubleBr(),jQuery(e._element).trigger(WYMeditor.EVENTS.postBlockMaybeCreated,e)},WYMeditor.editor.prototype.spaceBlockingElements=function(){var e,t,i,n,o,r,s=WYMeditor.DocumentStructureManager.CONTAINERS_BLOCKING_NAVIGATION.join(", "),a=jQuery(this._doc).find("body.wym_iframe"),l=a.children();e=jQuery.browser.mozilla?'<br class="'+WYMeditor.BLOCKING_ELEMENT_SPACER_CLASS+" "+WYMeditor.EDITOR_ONLY_CLASS+'" _moz_editor_bogus_node="TRUE" _moz_dirty=""/>':'<br class="'+WYMeditor.BLOCKING_ELEMENT_SPACER_CLASS+" "+WYMeditor.EDITOR_ONLY_CLASS+'"/>',l.length>0&&(t=jQuery(l[0]),i=jQuery(l[l.length-1]),t.is(s)&&t.before(e),!i.is(s)||jQuery.browser.msie&&jQuery.browser.version<"7.0"||i.after(e)),n=this._getBlockSepSelector(),a.find(n).before(e),o=this._getBlockInListSepSelector(),r=a.find(o),r.each(function(){var t=jQuery(this);t.next(s).length||t.next(WYMeditor.BR).length||t.after(e)})},WYMeditor.editor.prototype._getBlockSepSelector=function(){if("undefined"!=typeof this._blockSpacersSel)return this._blockSpacersSel;var e,t=this,i=[],n=WYMeditor.DocumentStructureManager.CONTAINERS_BLOCKING_NAVIGATION;return e=jQuery.grep(t.documentStructureManager.structureRules.validRootContainers,function(e){return-1===jQuery.inArray(e,n)}),jQuery.each(n,function(e,t){jQuery.each(n,function(e,n){i.push(t+" + "+n)})}),jQuery.each(n,function(t,n){jQuery.each(e,function(e,t){i.push(n+" + "+t),i.push(t+" + "+n)})}),this._blockSpacersSel=i.join(", "),this._blockSpacersSel},WYMeditor.editor.prototype._getBlockInListSepSelector=function(){if("undefined"!=typeof this._blockInListSpacersSel)return this._blockInListSpacersSel;var e=[];return jQuery.each(WYMeditor.LIST_TYPE_ELEMENTS,function(t,i){jQuery.each(WYMeditor.BLOCKING_ELEMENTS,function(t,n){e.push(i+" "+n)})}),this._blockInListSpacersSel=e.join(", "),this._blockInListSpacersSel},WYMeditor.editor.prototype.fixDoubleBr=function(){var e,t=jQuery(this._doc).find("body.wym_iframe");t.children("br + br").filter(":not(pre br)").remove(),t.find("p + br").next("p").prev("br").remove(),e=t.find("p + br").slice(-1),e.length>0&&0===e.next().length&&e.remove()},WYMeditor.editor.prototype.dialog=function(e,t,i){var n,o,r,s=t||this._wym._options.dialogFeatures,a=window.open("","dialog",s),l=WYMeditor.Helper;if(a){switch(n="",e){case WYMeditor.DIALOG_LINK:n=this._options.dialogLinkHtml;break;case WYMeditor.DIALOG_IMAGE:n=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:n=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:n=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:n=this._options.dialogPreviewHtml;break;default:n=i}o=this._options.dialogHtml,o=l.replaceAll(o,WYMeditor.BASE_PATH,this._options.basePath),o=l.replaceAll(o,WYMeditor.DIRECTION,this._options.direction),o=l.replaceAll(o,WYMeditor.WYM_PATH,this._options.wymPath),o=l.replaceAll(o,WYMeditor.JQUERY_PATH,this._options.jQueryPath),o=l.replaceAll(o,WYMeditor.DIALOG_TITLE,this.encloseString(e)),o=l.replaceAll(o,WYMeditor.DIALOG_BODY,n),o=l.replaceAll(o,WYMeditor.INDEX,this._index),o=this.replaceStrings(o),r=a.document,r.write(o),r.close()}},WYMeditor.editor.prototype.toggleHtml=function(){var e=jQuery(this._box).find(this._options.htmlSelector),t=jQuery(this._box).find(".wym_iframe"),i=this._box.find(".wym_tools_html");e.is(":visible")?(e.hide(),i.removeClass("selected"),jQuery(this._box).find(".ui-resizable-handle").show(),t.css("visibility","visible"),jQuery(this._doc).focus()):(e.show(),e.find("textarea").height(t.height()-10),e.find("textarea").width(t.width()-10),i.addClass("selected"),t.css("visibility","hidden"),jQuery(this._box).find(".ui-resizable-handle").hide())},WYMeditor.editor.prototype.uniqueStamp=function(){var e=new Date;return"wym-"+e.getTime()},WYMeditor.editor.prototype._handleMultilineBlockContainerPaste=function(e,t,i,n){var o,r,s,a,l,d,c,u,h,p,f,m;for(r=jQuery(f),a="p",t.is("li")&&(a="li"),i.splitBoundaries(),f=e.findUp(i.startContainer,["p","h1","h2","h3","h4","h5","h6","li"]),m=f.tagName,l=[],d=[],jQuery(f).contents().each(function(e,t){c=i.compareNode(t),c===i.NODE_BEFORE||c===i.NODE_BEFORE_AND_AFTER&&i.startOffset===i.startContainer.length?l.push(t):d.push(t)}),o=0;o<l.length;o++)jQuery(l[o]).remove();for(o=0;o<d.length;o++)jQuery(d[o]).remove();for(l.length>0&&jQuery(f).prepend(l),d.length>0&&(u=jQuery("<"+m+"></"+m+">",e._doc),u.insertAfter(jQuery(f)),u.append(d)),h=n.splice(0,1)[0],p=h.split(WYMeditor.NEWLINE).join("<br />"),jQuery(f).html(jQuery(f).html()+p),r=jQuery(f),o=0;o<n.length;o++)s="<"+a+">"+n[o].split(WYMeditor.NEWLINE).join("<br />")+"</"+a+">",r=jQuery(s,e._doc).insertAfter(r)},WYMeditor.editor.prototype.paste=function(e){var t,i,n,o,r,s,a,l,d,c,u,h,p=this.selected(),f="",m=!1;if(c=this,l=rangy.getIframeSelection(c._iframe),u=l.getRangeAt(0),r=jQuery(p),u.collapse(!0),t=e.split(new RegExp(WYMeditor.NEWLINE+"{2,}","g")),1===t.length&&(m=!0),"undefined"==typeof p||p&&p.tagName.toLowerCase()===WYMeditor.BODY)if(m)s=jQuery("<p>"+t[0]+"</p>",this._doc).appendTo(this._doc.body);else for(o="p",a=t.length-1;a>=0;a-=1)for(f="<"+o+">"+t[a].split(WYMeditor.NEWLINE).join("<br />")+"</"+o+">",h=jQuery(f,c._doc),i=h.length-1;i>=0;i--)u.insertNode(h[i]);else if(m||r.is("pre"))d=this._doc.createTextNode(e),u.insertNode(d);else if(r.is("p,h1,h2,h3,h4,h5,h6,li"))c._handleMultilineBlockContainerPaste(c,r,u,t);else for(n=e.split(WYMeditor.NEWLINE),a=n.length-1;a>=0;a-=1)d=this._doc.createTextNode(n[a]),u.insertNode(d),a>0&&u.insertNode(jQuery("<br />",c._doc).get(0));""===jQuery(p).text()&&jQuery(p).remove(),jQuery("body > br",this._doc).remove(),this.setFocusToNode(l.focusNode)},WYMeditor.editor.prototype.insert=function(e){var t,i,n=this._iframe.contentWindow.getSelection();null!==n.focusNode?(t=n.getRangeAt(0),i=t.createContextualFragment(e),t.deleteContents(),t.insertNode(i)):this.paste(e)},WYMeditor.editor.prototype.insertBlock=function(e){function t(e){return jQuery(e).closest("div, p, h1, h2, h3, embed, cite")[0]}var i,n=this.selection(),o=n.focusNode,r=n.focusOffset,s="after";o&&(i=t(o),i&&i!==o&&(3===o.nodeType&&r>0&&r<o.length&&rangy.dom.splitDataNode(o,r),rangy.CssClassApplier.util.splitNodeAt(i,o,r))),0===r&&(s="before"),n.deleteFromDocument(),this.insert_next(e,s)},WYMeditor.editor.prototype.insertText=function(e){var t,i=this.selection();t=i.getRangeAt(0),t.deleteContents(),t.insertNode(document.createTextNode(e))},WYMeditor.editor.prototype.insert_next=function(e,t){var i,n,o=this.selected(),r=jQuery(o),s=r.closest("blockquote");t||(t="after"),null!==o?r.is("body")?"after"===t?r.append(e):r.prepend(e):(s.length?"after"===t?s.after(e):s.before(e):(i=r.closest("div, p, h1, h2, h3, embed, cite"),i.length?"after"===t?i.after(e):i.before(e):"after"===t?r.closest("body").append(e):r.closest("body").prepend(e)),n=r.clone(),n.find("br, span").remove(),n.is(":empty")&&r.remove(),n.remove()):jQuery(this._doc.body).prepend(e),jQuery(this._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[this,jQuery(this._doc.body).html()])},WYMeditor.editor.prototype.insert_empty_p_if_next_block_is_uneditable=function(){var e=jQuery("[contenteditable=false]",this._doc);e.each(function(){var e=jQuery(this),t=e.next();return t.length&&"false"!==t[0].contentEditable&&!t.is("span.rangySelectionBoundary")?void(t.height()||t.append("&nbsp;")):void e.after("<p>&nbsp;</p>")})},WYMeditor.editor.prototype.wrap=function(e,t){this.insert(e+this._iframe.contentWindow.getSelection().toString()+t)},WYMeditor.editor.prototype.unwrap=function(){this.insert(this._iframe.contentWindow.getSelection().toString())},WYMeditor.editor.prototype.setFocusToNode=function(e,t){var i=rangy.createRange(this._doc),n=rangy.getIframeSelection(this._iframe);t=t||!1,i.selectNodeContents(e),i.collapse(t),n.setSingleRange(i)},WYMeditor.editor.prototype.splitListItemContents=function(e){var t,i,n,o=!1,r={itemContents:[],sublistContents:[]};for(t=e.contents(),i=0;i<t.length;i++)n=t.get(i),o||jQuery(n).is("ol,ul")?(o=!0,r.sublistContents.push(n)):r.itemContents.push(n);
return r},WYMeditor.editor.prototype.joinAdjacentLists=function(e,t){var i;"undefined"!=typeof e&&"undefined"!=typeof t&&e.nextSibling===t&&e.tagName.toLowerCase()===t.tagName.toLowerCase()&&(i=jQuery(t).contents(),i.unwrap(),i.detach(),jQuery(e).append(i))},WYMeditor.editor.prototype._indentSingleItem=function(e){var t,i,n,o,r,s,a,l,d,c,u,h,p=this;t=jQuery(e),i=t.parent()[0].tagName.toLowerCase(),r=p.splitListItemContents(t),a=jQuery(r.sublistContents),s=jQuery(r.itemContents),l=t.prev().filter("li"),0===l.length&&(n='<li class="spacer_li"></li>',t.before(n),l=t.prev()),d=l.contents().last().filter("ol,ul"),d.length>0?(d.append(t),a.detach(),l.append(a),c=a.first(),p.joinAdjacentLists(d.get(0),c.get(0))):(a.length>0?(a.detach(),l.append(a),d=a.first()):(o="<"+i+"></"+i+">",l.append(o),d=l.contents().last()),d.prepend(t)),t.next().is(".spacer_li")&&(u=t.next(".spacer_li"),h=u.contents(),h.detach(),t.append(h),u.remove())},WYMeditor.editor.prototype._outdentSingleItem=function(e){var t,i,n,o,r,s,a,l,d,c,u,h=this;if(t=jQuery(e),i=t.parent()[0].tagName.toLowerCase(),t.parent().parent().is("ol,ul,li")){if(t.parent().parent().is("li")||(WYMeditor.console.log("Attempting to fix invalid list nesting before outdenting."),h.correctInvalidListNesting(e)),o=h.splitListItemContents(t),s=jQuery(o.sublistContents),r=jQuery(o.itemContents),a=t.parent().parent("li"),0===a.length)return void WYMeditor.console.error("Invalid list. No parentLi found, so aborting outdent");l=t.parent(),d=t.nextAllContents(),c=l.nextAllContents(),t.detach(),a.after(t),s.length>0&&(n="<"+i+'><li class="spacer_li"></li></'+i+">",t.append(n),u=t.children().last(),s.detach(),u.children("li").append(s)),d.length>0&&("undefined"==typeof u&&(n="<"+i+"></"+i+">",t.append(n),u=t.children().last()),d.detach(),u.append(d)),c.length>0&&(c.detach(),t.contents().length>0&&t.contents().last()[0].nodeType===WYMeditor.NODE.TEXT&&c[0].nodeType===WYMeditor.NODE.TEXT&&t.append("<br />"),t.append(c)),0===l.contents().length&&l.remove(),0===a.contents().length&&a.remove()}},WYMeditor.editor.prototype.correctInvalidListNesting=function(e,t){var i,n,o=e;if("undefined"==typeof t&&(t=!1),!o)return t;for(;o.parentNode&&(i=o.parentNode,i.nodeType===WYMeditor.NODE.ELEMENT)&&(n=i.tagName.toLowerCase(),"ol"===n||"ul"===n||"li"===n);)o=i;return jQuery(o).is("li")?(WYMeditor.console.log("Correcting orphaned root li before correcting invalid list nesting."),this._correctOrphanedListItem(o),this.correctInvalidListNesting(o,!0)):jQuery(o).is("ol,ul")?this._correctInvalidListNesting(o,t):(WYMeditor.console.error("Can't correct invalid list nesting. No root list found"),t)},WYMeditor.editor.prototype._correctOrphanedListItem=function(e){var t,i,n,o,r=jQuery();t=jQuery(e).prevContentsUntil(":not(li)"),i=jQuery(e).nextContentsUntil(":not(li)"),r=r.add(t),r=r.add(e),r=r.add(i),o=r[0].previousSibling,o&&jQuery(o).is("ol,ul")?n=o:(r.before("<ol></ol>"),n=r.prev()[0]),jQuery(n).append(r)},WYMeditor.editor.prototype._correctInvalidListNesting=function(e,t){var i,n,o,r,s,a,l=e,d=e,c=!1,u='<li class="spacer_li"></li>';for("undefined"!=typeof t&&(c=t);d;)if(d._wym_visited){if(d._wym_visited=!1,d===l)break;d=d.previousSibling?d.previousSibling:d.parentNode}else{if(d!==l&&!jQuery(d).is("li"))for(o=d;o.parentNode&&(o=o.parentNode,!jQuery(o).is("li"))&&o.nodeType===WYMeditor.NODE.ELEMENT;)if(n=o.tagName.toLowerCase(),"ol"===n||"ul"===n){for(WYMeditor.console.log("Fixing orphaned list content"),c=!0,r=[d],i=d,s=null;i.previousSibling;){if(i=i.previousSibling,jQuery(i).is("li")){s=i;break}r.push(i)}r.reverse(),s||1!==r.length||jQuery(d.nextSibling).is("li")&&(s=d.nextSibling),s||(jQuery(r[0]).before(u),s=jQuery(r[0]).prev()[0]),a=jQuery(s).contents().last(),1===a.length&&a[0].nodeType===WYMeditor.NODE.TEXT&&r[0].nodeType===WYMeditor.NODE.TEXT&&jQuery(s).append("<br />"),jQuery(s).append(jQuery(r));break}d.lastChild?(d._wym_visited=!0,d=d.lastChild):d=d.previousSibling?d.previousSibling:d.parentNode}return c},WYMeditor.editor.prototype.getCommonParentList=function(e,t){var i,n,o,r=!0;return e=jQuery(e).filter("li"),0===e.length?null:(i=e[0],n=jQuery(i).parents("ol,ul"),n=t?n.first():n.last(),0===n.length?null:(o=n[0],jQuery(e).each(function(e,i){n=jQuery(i).parents("ol,ul"),n=t?n.first():n.last(),(0===n.length||n[0]!==o)&&(r=!1)}),r?o:null))},WYMeditor.editor.prototype._getSelectedListItems=function(e){var t,i,n,o,r,s,a,l=this,d=[],c=[];for(r=function(e){var t;if(rangy.dom.isCharacterDataNode(e))return e;try{t=n.containsNodeText(e)}catch(i){return!0}return t===!0?!0:void 0},t=0;t<e.rangeCount;t++)if(n=e.getRangeAt(t),n.collapsed===!0)o=l.findUp(n.startContainer,"li"),o&&(d=d.concat([o]));else{for(d=d.concat(n.getNodes([],r)),s=[],i=0;i<d.length;i++)if(a=d[i],!jQuery(a).is("li,ol,ul"))for(;a.parentNode;)if(a=a.parentNode,jQuery(a).is("li")){s.push(a);break}for(i=0;i<s.length;i++)-1===jQuery.inArray(s[i],d)&&d.push(s[i])}for(t=0;t<d.length;t++)d[t].nodeType===WYMeditor.NODE.ELEMENT&&d[t].tagName.toLowerCase()===WYMeditor.LI&&c.push(d[t]);return c},WYMeditor.editor.prototype._selectionOnlyInList=function(e){var t,i,n,o=this._wym;for(n=0;n<e.rangeCount;++n){if(t=o.findUp(e.getRangeAt(n).startContainer,["li"]),i=o.findUp(e.getRangeAt(n).endContainer,["li"]),!t||!i)return!1;if(!o.getCommonParentList([t,i],!1))return!1}return!0},WYMeditor.editor.prototype.indent=function(){var e,t,i,n=this._wym,o=rangy.getIframeSelection(this._iframe);return t=function(){var e=n.selected(),t=n.findUp(e,["ol","ul","li"]);return n.correctInvalidListNesting(t)},n.restoreSelectionAfterManipulation(t)?!0:(o=rangy.getIframeSelection(this._iframe),n._selectionOnlyInList(o)?(e=n._getSelectedListItems(o),0===e.length?!1:(t=function(){var t=!1;for(i=0;i<e.length;i++)n._indentSingleItem(e[i]),t=!0;return t},n.restoreSelectionAfterManipulation(t))):!1)},WYMeditor.editor.prototype.outdent=function(){var e,t,i,n=this._wym,o=rangy.getIframeSelection(this._iframe);return t=function(){var e=n.selected(),t=n.findUp(e,["ol","ul","li"]);return n.correctInvalidListNesting(t)},n.restoreSelectionAfterManipulation(t)?!0:(o=rangy.getIframeSelection(this._iframe),n._selectionOnlyInList(o)?(e=n._getSelectedListItems(o),0===e.length?!1:(t=function(){var t=!1;for(i=0;i<e.length;i++)n._outdentSingleItem(e[i]),t=!0;return t},n.restoreSelectionAfterManipulation(t))):!1)},WYMeditor.editor.prototype.restoreSelectionAfterManipulation=function(e){var t=rangy.saveSelection(rangy.dom.getIframeWindow(this._iframe)),i=!0;try{i=e(),i?rangy.restoreSelection(t):rangy.removeMarkers(t)}catch(n){WYMeditor.console.error("Error during manipulation"),WYMeditor.console.error(n),rangy.removeMarkers(t)}return i},WYMeditor.editor.prototype.insertOrderedlist=function(){var e,t=this;return e=function(){var e=t.selected(),i=t.findUp(e,["ol","ul","li"]);return t.correctInvalidListNesting(i)},t.restoreSelectionAfterManipulation(e)?!0:(e=function(){return t._insertList("ol")},t.restoreSelectionAfterManipulation(e))},WYMeditor.editor.prototype.insertUnorderedlist=function(){var e,t=this;return e=function(){var e=t.selected(),i=t.findUp(e,["ol","ul","li"]);return t.correctInvalidListNesting(i)},t.restoreSelectionAfterManipulation(e)?!0:(e=function(){return t._insertList("ul")},t.restoreSelectionAfterManipulation(e))},WYMeditor.editor.prototype._insertList=function(e){var t,i,n=this._wym,o=rangy.getIframeSelection(this._iframe),r=this.selection().getAllRanges();return t=n._getSelectedListItems(o),0!==t.length?(i=n.getCommonParentList(t,!0),i?(this._changeListType(i,e),!0):!1):(jQuery.each(r,function(){this.collapsed&&n._ensureListItem(n.selected(),e),jQuery.each(this.getNodes(),function(){n._ensureListItem(this,e)})}),!1)},WYMeditor.editor.prototype._ensureListItem=function(e,t){var i,n,o=this._wym,r=o.findUp(e,WYMeditor.POTENTIAL_LIST_ELEMENTS);return r?(i=jQuery(r),n=i.prev(t).add(i.next(t)),1===n.length?n.append(o._convertToListItem(jQuery(r))):o._convertToList(r,t),!0):void 0},WYMeditor.editor.prototype._changeListType=function(e,t){return WYMeditor.changeNodeType(e,t)},WYMeditor.editor.prototype._convertToListItem=function(e){var t=jQuery([]);return e.each(function(){var e=jQuery(this),i=jQuery("<li></li>");i.append(e.html()),e.remove(),t=t.add(i)}),t},WYMeditor.editor.prototype._convertToList=function(e,t){var i,n,o=jQuery(e),r=this._wym;return i="<"+t+"><li></li></"+t+">",this.findUp(e,WYMeditor.MAIN_CONTAINERS)===e?(n=jQuery(i),n.empty(),o.after(n),n.append(r._convertToListItem(o)),o.remove()):(o.wrapInner(i),n=o.children()),n.get(0)},WYMeditor.editor.prototype.insertTable=function(e,t,i,n){if(!(0>=e||0>=t)){var o,r,s,a,l,d=this._doc.createElement(WYMeditor.TABLE),c=null;for(o=d.createCaption(),o.innerHTML=i,r=0;e>r;r+=1)for(c=d.insertRow(r),s=0;t>s;s+=1)c.insertCell(s);if(""!==n&&jQuery(d).attr("summary",n),a=jQuery(this.findUp(this.container(),WYMeditor.POTENTIAL_TABLE_INSERT_ELEMENTS)).get(0),a&&a.parentNode)if(jQuery.inArray(a.nodeName.toLowerCase(),WYMeditor.INLINE_TABLE_INSERTION_ELEMENTS)>-1){if(l=this.selection().focusNode,jQuery.inArray(l.nodeName.toLowerCase(),WYMeditor.SELECTABLE_TABLE_ELEMENTS)>-1||jQuery.inArray(l.parentNode.nodeName.toLowerCase(),WYMeditor.SELECTABLE_TABLE_ELEMENTS)>-1)for(;l.nodeName.toLowerCase()!==WYMeditor.TABLE;)l=l.parentNode;l.nodeName.toLowerCase()===WYMeditor.LI?jQuery(l).append(d):jQuery(l).after(d)}else jQuery(a).after(d);else jQuery(this._doc.body).append(d);return this.afterInsertTable(d),this.fixBodyHtml(),d}},WYMeditor.editor.prototype.afterInsertTable=function(){},WYMeditor.editor.prototype.listen=function(){var e=this;jQuery(this._doc.body).bind("mouseup keyup change",function(t){e.update_selections.apply(e,[t])}),jQuery(e._doc.body).bind("mousedown",function(t){e.mousedown(t)}),jQuery(e._doc).bind("paste",function(){e.handlePasteEvent()})},WYMeditor.editor.prototype.handlePasteEvent=function(){var e=this;window.setTimeout(function(){jQuery(e._element).trigger(WYMeditor.EVENTS.postBlockMaybeCreated,e)},20)},WYMeditor.editor.prototype.mousedown=function(e){this._selectedImage=null,e.target.tagName.toLowerCase()===WYMeditor.IMG&&(this._selectedImage=e.target)},WYMeditor.editor.prototype.update_selections=function(){var e=this;e._box.find(".wym_tools ul > li:not(.wym_tools_html)").removeClass("selected").removeClass("partially_selected"),this.selected_parents_contains("b").length&&e._box.find(".wym_tools_strong").addClass("selected"),this.selected_parents_contains("i").length&&e._box.find(".wym_tools_emphasis").addClass("selected"),this.selected_parents_contains("a").length&&e._box.find(".wym_tools_link, .wym_tools_unlink").addClass("selected"),this.selected_parents_contains("li").length&&e._box.find(".wym_tools_unordered_list").addClass("selected"),this.selected_parents_contains("h1").length&&e._box.find(".wym_tools_header").addClass("selected"),this.selected_parents_contains("blockquote").length&&e._box.find(".wym_tools_blockquote").addClass("selected"),jQuery.each(["b","i","a","li","ul"],function(){var t=e.selected_contains(this);t.length&&("b"===this?e._box.find(".wym_tools_strong").addClass("partially_selected"):"i"===this?e._box.find(".wym_tools_emphasis").addClass("partially_selected"):"a"===this?e._box.find(".wym_tools_link, .wym_tools_unlink").addClass("partially_selected"):"li"===this||"ul"===this?e._box.find(".wym_tools_unordered_list").addClass("partially_selected"):"h1"===this?e._box.find(".wym_tools_header").addClass("partially_selected"):"blockquote"===this&&e._box.find(".wym_tools_blockquote").addClass("partially_selected"))})},WYMeditor.editor.prototype.initSkin=function(){jQuery(this._box).addClass("wym_skin_"+this._options.skin),"undefined"!=typeof WYMeditor.SKINS[this._options.skin]?"function"==typeof WYMeditor.SKINS[this._options.skin].init&&WYMeditor.SKINS[this._options.skin].init(this):WYMeditor.console.warn("Chosen skin _"+this.options.skin+"_ not found.")},WYMeditor.WymClassSafari=function(e){this._wym=e,this._class="class"},WYMeditor.WymClassSafari.prototype.initIframe=function(e){var t=this;t._iframe=e,t._doc=e.contentDocument,t._doc.title=t._wym._index,jQuery("html",t._doc).attr("dir",t._options.direction),this._doc.body.contentEditable="true",this._html(this._wym._options.html),jQuery.isFunction(t._options.preBind)&&t._options.preBind(t),t._wym.bindEvents(),jQuery(t._doc).bind("keydown",t.keydown),jQuery(t._doc).bind("keyup",t.keyup),jQuery.isFunction(t._options.postInit)&&t._options.postInit(t),t.listen(),jQuery(t._element).trigger(WYMeditor.EVENTS.postIframeInitialization,t._wym)},WYMeditor.WymClassSafari.prototype._exec=function(e,t){if(!this.selected())return!1;var i,n,o,r,s;return t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null),i=this.selected(),i&&(n=jQuery(i),o=i.tagName.toLowerCase(),o===WYMeditor.BODY&&(r=this.documentStructureManager.structureRules,this._exec(WYMeditor.FORMAT_BLOCK,r.defaultRootContainer),this.fixBodyHtml()),e===WYMeditor.FORMAT_BLOCK&&n.siblings("body.wym_iframe").length&&n.siblings("body.wym_iframe").append(i),"span"===o&&(s=!n.attr("class")||"apple-style-span"===n.attr("class").toLowerCase(),s&&"font-weight: normal;"===n.attr("style")&&n.contents().unwrap())),!0},WYMeditor.WymClassSafari.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title];e.ctrlKey?(e.which===WYMeditor.KEY.B&&(t._exec(WYMeditor.BOLD),e.preventDefault()),e.which===WYMeditor.KEY.I&&(t._exec(WYMeditor.ITALIC),e.preventDefault())):e.shiftKey&&e.which===WYMeditor.KEY.ENTER&&(t._exec("InsertLineBreak"),e.preventDefault())},WYMeditor.WymClassSafari.prototype.keyup=function(e){var t,i,n,o,r,s=WYMeditor.INSTANCES[this.title];n=s.documentStructureManager.structureRules.notValidRootContainers,i=s.documentStructureManager.structureRules.defaultRootContainer,s._selectedImage=null,jQuery.browser.version<534.1&&e.which===WYMeditor.KEY.ENTER&&e.shiftKey&&s._exec("InsertLineBreak"),s.keyCanCreateBlockElement(e.which)||e.which===WYMeditor.KEY.CTRL||e.which===WYMeditor.KEY.COMMAND||e.metaKey||e.ctrlKey||(t=s.selected(),o=t?t.tagName.toLowerCase():"body",t&&t.parentNode&&(r=t.parentNode.tagName.toLowerCase()),s.isForbiddenMainContainer(o)&&(o=r),(o===WYMeditor.BODY||jQuery.inArray(o,n)>-1&&r===WYMeditor.BODY)&&(s._exec(WYMeditor.FORMAT_BLOCK,i),s.fixBodyHtml())),s.keyCanCreateBlockElement(e.which)&&(t=s.selected(),o=t.tagName.toLowerCase(),t.parentNode&&(r=t.parentNode.tagName.toLowerCase()),jQuery.inArray(o,n)>-1&&r===WYMeditor.BODY&&s._exec(WYMeditor.FORMAT_BLOCK,i),s.fixBodyHtml()),jQuery(s._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[s,jQuery(s._doc.body).html()])},WYMeditor.WymClassMozilla=function(e){this._wym=e,this._class="class"},WYMeditor.WymClassMozilla.CELL_PLACEHOLDER='<br _moz_dirty="" />',WYMeditor.WymClassMozilla.NEEDS_CELL_FIX=1===parseInt(jQuery.browser.version,10)&&jQuery.browser.version>="1.9.1"&&jQuery.browser.version<"2.0",WYMeditor.WymClassMozilla.prototype.initIframe=function(e){var t=this;this._iframe=e,this._doc=e.contentDocument,this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._html(this._wym._options.html),this.enableDesignMode(),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery(this._doc).bind("click",this.click),jQuery(this._doc).bind("focus",function(){t.enableDesignMode.call(t)}),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen(),jQuery(t._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)},WYMeditor.WymClassMozilla.prototype._html=function(e){if("string"!=typeof e)return jQuery(this._doc.body).html();try{this._doc.designMode="off"}catch(t){}return e=e.replace(/<em(\b[^>]*)>/gi,"<i$1>"),e=e.replace(/<\/em>/gi,"</i>"),e=e.replace(/<strong(\b[^>]*)>/gi,"<b$1>"),e=e.replace(/<\/strong>/gi,"</b>"),jQuery(this._doc.body).html(e),this._wym.fixBodyHtml(),this.enableDesignMode(),!1},WYMeditor.WymClassMozilla.prototype._exec=function(e,t){if(!this.selected())return!1;t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null);var i=this.selected();return i&&i.tagName.toLowerCase()===WYMeditor.BODY&&(this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),this.fixBodyHtml()),!0};var $lastFocusedP=jQuery([]);WYMeditor.WymClassMozilla.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title],i=jQuery(t.selection().focusNode).closest("p");if(i.length&&($lastFocusedP=i),e.ctrlKey){if(66===e.which)return t._exec(WYMeditor.BOLD),!1;if(73===e.which)return t._exec(WYMeditor.ITALIC),!1}return!0},WYMeditor.WymClassMozilla.prototype.keyup=function(e){var t,i,n,o,r,s=WYMeditor.INSTANCES[this.title];n=s.documentStructureManager.structureRules.notValidRootContainers,i=s.documentStructureManager.structureRules.defaultRootContainer,s._selectedImage=null,t=null,s.keyCanCreateBlockElement(e.which)||e.which===WYMeditor.KEY.CTRL||e.which===WYMeditor.KEY.COMMAND||e.metaKey||e.ctrlKey||(t=s.selected(),o=t?t.tagName.toLowerCase():"body",t.parentNode&&(r=t.parentNode.tagName.toLowerCase()),s.isForbiddenMainContainer(o)&&(o=r),(o===WYMeditor.BODY||jQuery.inArray(o,n)>-1&&r===WYMeditor.BODY)&&(s._exec(WYMeditor.FORMAT_BLOCK,i),s.fixBodyHtml())),s.keyCanCreateBlockElement(e.which)&&(t=s.selected(),o=t.tagName.toLowerCase(),t.parentNode&&(r=t.parentNode.tagName.toLowerCase()),jQuery.inArray(o,n)>-1&&r===WYMeditor.BODY&&s._exec(WYMeditor.FORMAT_BLOCK,i),s.fixBodyHtml()),jQuery(s._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[s,jQuery(s._doc.body).html()])},WYMeditor.WymClassMozilla.prototype.click=function(){var e,t=WYMeditor.INSTANCES[this.title],i=t.selected();WYMeditor.WymClassMozilla.NEEDS_CELL_FIX===!0&&i&&i.tagName.toLowerCase()===WYMeditor.TR&&jQuery(WYMeditor.TD,t._doc.body).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER),i&&i.tagName.toLowerCase()===WYMeditor.BODY&&(e=t._iframe.contentWindow.getSelection(),e.isCollapsed===!0&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))},WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){this._doc.body.contentEditable="true",this._doc.execCommand("styleWithCSS","",!1),this._doc.execCommand("enableObjectResizing",!1,!1)},WYMeditor.WymClassMozilla.prototype.afterInsertTable=function(e){WYMeditor.WymClassMozilla.NEEDS_CELL_FIX===!0&&jQuery(e).find("td").each(function(e,t){jQuery(t).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER)})},WYMeditor.WymClassExplorer=function(e){this._wym=e,this._class="className"},WYMeditor.WymClassExplorer.prototype.initIframe=function(e){var t,i=this;this._iframe=e,this._doc=e.contentWindow.document,this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),jQuery(this._doc.body).html(this._wym._options.html),this._doc.body.onfocus=function(){i._doc.body.contentEditable="true",i._doc=e.contentWindow.document},this._doc.onbeforedeactivate=function(){i.saveCaret()},jQuery(this._doc).bind("keyup",i.keyup),t=parseInt(jQuery.browser.version,10),t>=8&&9>t&&jQuery(this._doc).bind("keydown",function(){i.fixBluescreenOfDeath()}),this._doc.onkeyup=function(){i.saveCaret()},this._doc.onclick=function(){i.saveCaret()},jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen(),jQuery(i._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym);try{this._doc=e.contentWindow.document}catch(n){}},function(e){WYMeditor.WymClassExplorer.prototype.initSkin=function(){jQuery(this._box).find(this._options.containerSelector).attr("unselectable","on"),e.call(this)}}(WYMeditor.editor.prototype.initSkin),WYMeditor.WymClassExplorer.prototype._exec=function(e,t){t?this._doc.execCommand(e,!1,t):this._doc.execCommand(e)},WYMeditor.WymClassExplorer.prototype.selected=function(){var e=this._iframe.contentWindow.document.caretPos;return e&&e.parentElement?e.parentElement():void 0},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.insert=function(e){var t,i=this._doc.selection.createRange();if(t=jQuery(i.parentElement()).parents(),t.is(this._options.iframeBodySelector))try{i.pasteHTML(e)}catch(n){}else this.paste(e)},WYMeditor.WymClassExplorer.prototype.wrap=function(e,t){var i,n=this._doc.selection.createRange();if(i=jQuery(n.parentElement()).parents(),i.is(this._options.iframeBodySelector))try{n.pasteHTML(e+n.text+t)}catch(o){}},WYMeditor.WymClassExplorer.prototype.wrapWithContainer=function(e,t){var i,n,o,r=this._wym;i=jQuery(e).wrap("<"+t+" />"),n=rangy.getIframeSelection(r._iframe),o=rangy.createRange(r._doc),o.selectNodeContents(i[0]),o.collapse(),n.setSingleRange(o)},WYMeditor.WymClassExplorer.prototype.unwrap=function(){var e,t,i=this._doc.selection.createRange();if(e=jQuery(i.parentElement()).parents(),e.is(this._options.iframeBodySelector))try{t=i.text,this._exec("Cut"),i.pasteHTML(t)}catch(n){}},WYMeditor.WymClassExplorer.prototype.keyup=function(e){var t,i,n,o,r,s,a=WYMeditor.INSTANCES[this.title],l=!1;n=a.documentStructureManager.structureRules.notValidRootContainers,i=a.documentStructureManager.structureRules.defaultRootContainer,this._selectedImage=null,a.keyCanCreateBlockElement(e.which)||e.which===WYMeditor.KEY.CTRL||e.which===WYMeditor.KEY.COMMAND||e.metaKey||e.ctrlKey||(t=a.selected(),s=a.selection().focusNode,t&&t.tagName&&(o=t.tagName.toLowerCase()),t.parentNode&&(r=t.parentNode.tagName.toLowerCase()),a.isForbiddenMainContainer(o)&&(o=r,l=!0),o===WYMeditor.BODY&&"#text"===s.nodeName&&(l&&(s=s.parentNode),a.wrapWithContainer(s,i),a.fixBodyHtml())),(e.keyCode===WYMeditor.KEY.UP||e.keyCode===WYMeditor.KEY.DOWN||e.keyCode===WYMeditor.KEY.BACKSPACE||e.keyCode===WYMeditor.KEY.ENTER)&&jQuery.inArray(o,n)>-1&&r===WYMeditor.BODY&&(a.switchTo(t,i),a.fixBodyHtml()),jQuery(a._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[a,jQuery(a._doc.body).html()])},WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(e,t){var i=this._doc.selection.createRange();t=t?!0:!1,i.moveToElementText(e),i.collapse(t),i.select(),e.focus()},WYMeditor.WymClassExplorer.prototype.paste=function(e){var t,i,n,o,r=this.selected(),s="";if(r&&r.tagName.toLowerCase()!==WYMeditor.BODY)t=jQuery(r).append(e),i=t[t.length-1];else{for(t=e.split(new RegExp(this._newLine+"{2,}","g")),n=0,o=t.length;o>n;n++)s+="<p>"+t[n].split(this._newLine).join("<br />")+"</p>";t=jQuery(s,this._doc).appendTo(this._doc.body),i=t[t.length-1]}jQuery("body > br",this._doc).remove(),this.setFocusToNode(i)},WYMeditor.WymClassOpera=function(e){this._wym=e,this._class="class",this._newLine="\r\n"},WYMeditor.WymClassOpera.prototype.initIframe=function(e){this._iframe=e,this._doc=e.contentWindow.document,this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._doc.body.contentEditable="true",this._html(this._wym._options.html),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen(),jQuery(wym._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)},WYMeditor.WymClassOpera.prototype._exec=function(e,t){t?this._doc.execCommand(e,!1,t):this._doc.execCommand(e)},WYMeditor.WymClassOpera.prototype.selected=function(){var e=this._iframe.contentWindow.getSelection(),t=e.focusNode;return t?"#text"===t.nodeName?t.parentNode:t:null},WYMeditor.WymClassOpera.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title],i=t._iframe.contentWindow.getSelection(),n=i.getRangeAt(0).startContainer;jQuery(n).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]||jQuery(n).parentsOrSelf("li")||keyCanCreateBlockElement(e.which)||t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassOpera.prototype.keyup=function(e){var t=WYMeditor.INSTANCES[this.title];t._selected_image=null,$(t._element).trigger(WYMeditor.EVENTS.documentHTMLUpdated,[t,$(t._doc.body).html()])},WYMeditor.editor.prototype.resizable=function(e){var t=this,i=jQuery(t._box).find("iframe"),n=jQuery(t._box).find(".wym_iframe"),o={resize:function(){n.height(i.height())},alsoResize:i,handles:"s,e,se",minHeight:250},r=jQuery.extend(o,e);jQuery.isFunction(jQuery.fn.resizable)?jQuery(t._box).resizable(r):WYMeditor.console.error("Oops, jQuery UI.resizable unavailable.")},function(e,t){function i(e){return parseInt(e,10)||0}function n(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,i,n,o,r,s=this,a=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)n=e.trim(t[i]),r="ui-resizable-"+n,o=e("<div class='ui-resizable-handle "+r+"'></div>"),o.css({zIndex:a.zIndex}),"se"===n&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(o);this._renderAxis=function(t){var i,n,o,r;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(n=e(this.handles[i],this.element),r=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),o=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(o,r),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(e(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){a.disabled||s.resizing||(e(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,n,o=!1;for(i in this.handles)n=e(this.handles[i])[0],(n===t.target||e.contains(n,t.target))&&(o=!0);return!this.options.disabled&&o},_mouseStart:function(t){var n,o,r,s=this.options,a=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy(),n=i(this.helper.css("left")),o=i(this.helper.css("top")),s.containment&&(n+=e(s.containment).scrollLeft()||0,o+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:o},this.size=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:n,top:o},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===r?this.axis+"-resize":r),l.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,n=this.helper,o={},r=this.originalMousePosition,s=this.axis,a=this.position.top,l=this.position.left,d=this.size.width,c=this.size.height,u=t.pageX-r.left||0,h=t.pageY-r.top||0,p=this._change[s];return p?(i=p.apply(this,[t,u,h]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),this.position.top!==a&&(o.top=this.position.top+"px"),this.position.left!==l&&(o.left=this.position.left+"px"),this.size.width!==d&&(o.width=this.size.width+"px"),this.size.height!==c&&(o.height=this.size.height+"px"),n.css(o),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(o)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,n,o,r,s,a,l,d=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),o=n&&e.ui.hasScroll(i[0],"left")?0:c.sizeDiff.height,r=n?0:c.sizeDiff.width,s={width:c.helper.width()-r,height:c.helper.height()-o},a=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,d.animate||this.element.css(e.extend(s,{top:l,left:a})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!d.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,i,o,r,s,a=this.options;s={minWidth:n(a.minWidth)?a.minWidth:0,maxWidth:n(a.maxWidth)?a.maxWidth:1/0,minHeight:n(a.minHeight)?a.minHeight:0,maxHeight:n(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,o=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),o>s.minHeight&&(s.minHeight=o),i<s.maxWidth&&(s.maxWidth=i),r<s.maxHeight&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,o=this.axis;return n(e.height)?e.width=e.height*this.aspectRatio:n(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===o&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===o&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,o=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,r=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=n(e.width)&&t.minWidth&&t.minWidth>e.width,a=n(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,d=this.position.top+this.size.height,c=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);
return s&&(e.width=t.minWidth),a&&(e.height=t.minHeight),o&&(e.width=t.maxWidth),r&&(e.height=t.maxHeight),s&&c&&(e.left=l-t.minWidth),o&&c&&(e.left=l-t.maxWidth),a&&u&&(e.top=d-t.minHeight),r&&u&&(e.top=d-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,i,n,o,r=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(o=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],i=[o.css("borderTopWidth"),o.css("borderRightWidth"),o.css("borderBottomWidth"),o.css("borderLeftWidth")],n=[o.css("paddingTop"),o.css("paddingRight"),o.css("paddingBottom"),o.css("paddingLeft")],t=0;t<i.length;t++)this.borderDif[t]=(parseInt(i[t],10)||0)+(parseInt(n[t],10)||0);o.css({height:r.height()-this.borderDif[0]-this.borderDif[2]||0,width:r.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=this.originalSize,o=this.originalPosition;return{top:o.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("ui-resizable"),n=i.options,o=i._proportionallyResizeElements,r=o.length&&/textarea/i.test(o[0].nodeName),s=r&&e.ui.hasScroll(o[0],"left")?0:i.sizeDiff.height,a=r?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},d=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&d?{top:c,left:d}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};o&&o.length&&e(o[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,n,o,r,s,a,l,d=e(this).data("ui-resizable"),c=d.options,u=d.element,h=c.containment,p=h instanceof e?h.get(0):/parent/.test(h)?u.parent().get(0):h;p&&(d.containerElement=e(p),/document/.test(h)||h===document?(d.containerOffset={left:0,top:0},d.containerPosition={left:0,top:0},d.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),n=[],e(["Top","Right","Left","Bottom"]).each(function(e,o){n[e]=i(t.css("padding"+o))}),d.containerOffset=t.offset(),d.containerPosition=t.position(),d.containerSize={height:t.innerHeight()-n[3],width:t.innerWidth()-n[1]},o=d.containerOffset,r=d.containerSize.height,s=d.containerSize.width,a=e.ui.hasScroll(p,"left")?p.scrollWidth:s,l=e.ui.hasScroll(p)?p.scrollHeight:r,d.parentData={element:p,left:o.left,top:o.top,width:a,height:l}))},resize:function(t){var i,n,o,r,s=e(this).data("ui-resizable"),a=s.options,l=s.containerOffset,d=s.position,c=s._aspectRatio||t.shiftKey,u={top:0,left:0},h=s.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(u=l),d.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-u.left),c&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=a.helper?l.left:0),d.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),c&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?l.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,i=Math.abs((s._helper?s.offset.left-u.left:s.offset.left-u.left)+s.sizeDiff.width),n=Math.abs((s._helper?s.offset.top-u.top:s.offset.top-l.top)+s.sizeDiff.height),o=s.containerElement.get(0)===s.element.parent().get(0),r=/relative|absolute/.test(s.containerElement.css("position")),o&&r&&(i-=s.parentData.left),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,c&&(s.size.height=s.size.width/s.aspectRatio)),n+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-n,c&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.containerOffset,o=t.containerPosition,r=t.containerElement,s=e(t.helper),a=s.offset(),l=s.outerWidth()-t.sizeDiff.width,d=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(r.css("position"))&&e(this).css({left:a.left-o.left-n.left,width:l,height:d}),t._helper&&!i.animate&&/static/.test(r.css("position"))&&e(this).css({left:a.left-o.left-n.left,width:l,height:d})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("ui-resizable"),o=n.options,r=n.originalSize,s=n.originalPosition,a={height:n.size.height-r.height||0,width:n.size.width-r.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(t,n){e(t).each(function(){var t=e(this),o=e(this).data("ui-resizable-alsoresize"),r={},s=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var i=(o[t]||0)+(a[t]||0);i&&i>=0&&(r[t]=i||null)}),t.css(r)})};"object"!=typeof o.alsoResize||o.alsoResize.nodeType?l(o.alsoResize):e.each(o.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size,o=t.originalSize,r=t.originalPosition,s=t.axis,a="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=a[0]||1,d=a[1]||1,c=Math.round((n.width-o.width)/l)*l,u=Math.round((n.height-o.height)/d)*d,h=o.width+c,p=o.height+u,f=i.maxWidth&&i.maxWidth<h,m=i.maxHeight&&i.maxHeight<p,_=i.minWidth&&i.minWidth>h,g=i.minHeight&&i.minHeight>p;i.grid=a,_&&(h+=l),g&&(p+=d),f&&(h-=l),m&&(p-=d),/^(se|s|e)$/.test(s)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(s)?(t.size.width=h,t.size.height=p,t.position.top=r.top-u):/^(sw)$/.test(s)?(t.size.width=h,t.size.height=p,t.position.left=r.left-c):(t.size.width=h,t.size.height=p,t.position.top=r.top-u,t.position.left=r.left-c)}})}(jQuery),instrument_function(function(e){!function(e){function t(t,i){this.$elem=t,this.$close_a=t.find("a.modal_dialog_close");var n=t.children(),o=n.children(),r=o.children(),s=t.add(n).add(o).add(r).add(this.$close_a);this.options=e.extend({close_link:s,scroll_margin:20,ignore_parent:!1,prevent_close:!1},i),this.prevent_close=this.options.prevent_close,this.prevent_close&&this.$close_a.hide(),this.options.ignore_parent||this._bind_parent_modal(),this._remember_original_css(),this._attach()}function i(t,i){var o,r=e([]);return e.each(n,function(e){url_equals(t,e,{include_query:!0})&&(o=this)}),o||(r=e.create_modal_dialog(i.title||"","spinner",i),r.addClass("spinning"),o=r.data("modal_dialog"),o.remote_url=t,o.remote_xhr=e.ajax({url:t,type:"get",dataType:i.dataType,beforeSend:i.beforeSend,success:function(n){var o=e(n);i.remote_modal_dialog_contents_loaded&&i.remote_modal_dialog_contents_loaded.apply(this,[o,i,t]),r.find(".modal_dialog_body").html(o),r.removeClass("spinning"),r.trigger("size_change"),r.trigger("modal_dialog:remote_dialog_loaded")},error:function(){r.trigger("modal_dialog:errored",arguments),r.remove(),delete n[t]}}),i.do_not_cache||(n[t]=o)),o}e.fn.modal_dialog=function(i){return i=i||{},e(this).each(function(){var n=e(this).data("modal_dialog");n||(n=new t(e(this),i),e(this).data("modal_dialog",n)),n.open()})};var n={};e.create_modal_dialog=function(i,n,o){o=o||{},i.length&&(i="<h4>"+i+"</h4>");var r,s=e('<div class="modal_dialog '+(void 0!==o.theme?o.theme:"dark")+(void 0!==o.class_name?" "+o.class_name:"")+'"'+(void 0!==o.id?' id="'+o.id+'" ':" ")+'style="display: none;"><div class="modal_dialog_outer"><div class="modal_dialog_sizer"><div class="modal_dialog_inner"><div class="modal_dialog_content"><div class="modal_dialog_head">'+i+'<a class="modal_dialog_close" href="#"><span class="ss-icon ss-delete"></span></a></div><div class="modal_dialog_body">'+n+'</div></div></div><span class="modal_dialog_ie_hack"></span></div></div></div>');return e("body").append(s),r=new t(s,o),s.data("modal_dialog",r),s},e.open_remote_modal_dialog=function(t,n){var o=e(".modal_dialog:visible");if(!o.data("modal_dialog")||o.data("modal_dialog").remote_url!==t){n=n||{};var r=i(t,n);return r.open(),r}},e.extend(t.prototype,{_attach:function(){if(!this._attached){var t=this,i=e(this.options.close_link);this._attached=!0,this.overflow_scroll="scroll"===this.$elem.css("overflow"),this.$elem.on("close.modal_dialog",function(){t.close()}),this.$elem.on("size_change.modal_dialog",function(){t._on_size_changed()}),this.$elem.on("prevent_close.modal_dialog",function(){t._set_prevent_close(!0)}),this.$elem.on("allow_close.modal_dialog",function(){t._set_prevent_close(!1)}),e(window).on("resize.modal_dialog",function(){t._on_size_changed()}),i.on("click.modal_dialog",function(e){-1!==i.index(e.target)&&(t.close(e),e.preventDefault())}),this.$elem.keydown(function(e){27===e.keyCode&&(t.close(e),e.preventDefault())})}},_detach:function(){this._attached=!1,e(this.options.close_link).off("click.modal_dialog"),this.$elem.off("size_change.modal_dialog"),e(window).off("resize.modal_dialog")},_bind_parent_modal:function(){this.$parent_modal=e([]),this.$elem.on("before_close.modal_dialog",function(){var t=e(this).data("modal_dialog").$parent_modal;t.show(),t=e([])})},_on_size_changed:function(e){var t=this.$elem.find("div.modal_dialog_inner");!this.overflow_scroll&&t.height()>this._get_viewport_height()?this._resize_to_position_absolute(e):this._resize_to_position_fixed()},_resize_to_position_fixed:function(){this._apply_original_css()},_resize_to_position_absolute:function(t){var i=e(document).height(),n=document.documentElement&&document.documentElement.scrollTop||e("body")[0].scrollTop+e("html")[0].scrollTop,o=this.$elem.find("div.modal_dialog_inner"),r=o.height(),s=this.options.scroll_margin,a=n+r+2*s,l=a>i?a:i,d=l-n-r-2*s,c="absolute"===this.$elem.css("position");this.$elem.css("position","absolute"),this.$elem.css("top","0"),this.$elem.css("height",i),(!c||t)&&(o.css("margin-top",n+s),o.css("margin-bottom",d))},_remember_original_css:function(){this._elem_original_css={},this._inner_original_css={};var t=this.$elem.find("div.modal_dialog_inner"),i=["position","top"],n=["margin-top","margin-bottom"],o=this;e.each(i,function(e){var t=i[e];o._elem_original_css[t]=o.$elem.css(t)}),e.each(n,function(e){var i=n[e];o._inner_original_css[i]=t.css(i)})},_get_viewport_height:function(){return e.browser.msie?window.document.documentElement.clientHeight:window.innerHeight},_apply_original_css:function(){var e,t,i=this.$elem.find("div.modal_dialog_inner");for(e in this._elem_original_css)this._elem_original_css.hasOwnProperty(e)&&(t=this._elem_original_css[e],this.$elem.css(e,t));for(e in this._inner_original_css)this._inner_original_css.hasOwnProperty(e)&&(t=this._inner_original_css[e],i.css(e,t));this.$elem.css("height","100%")},_set_prevent_close:function(e){this.prevent_close=e,e?this.$close_a.hide():this.$close_a.show()},open:function(){var t=this.$elem.parents("body");t.length&&t.append(this.$elem),this.options.ignore_parent||(this.$parent_modal=e(".modal_dialog:visible"),this.$parent_modal.hide()),this.$elem.show(),this._on_size_changed(!0),this.overflow_scroll&&e("html").css("overflow","hidden"),this.$elem.trigger("modal_dialog:opened",[this]),this._attach()},close:function(t){this.prevent_close||(this.$elem.trigger("before_close.modal_dialog",[t]),t&&t.isDefaultPrevented()||(this._detach(),this.options.do_not_cache?this.$elem.remove():this.$elem.hide(),this.overflow_scroll&&e("html").css("overflow","visible"),this.$elem.trigger("closed.modal_dialog",[t])))}}),e.modal_confirm=function(t,i){var n,o,r,s={message:I18n.t("library.modal_dialog.Do_you_really_want_to_do_this"),confirm_text:I18n.t("library.modal_dialog.Confirm"),cancel_text:I18n.t("library.modal_dialog.Cancel"),title:I18n.t("library.modal_dialog.Are_you_sure")};i=e.extend({},s,i),n='<div style="max-width:600px;">'+i.message+'<p class="clearfix"><a class="confirm btn btn--blue left" href="#">'+i.confirm_text+'</a><a class="cancel button-space left ml1 lh40 grey-dark" href="#">'+i.cancel_text+"</a></p></div>",o=e.create_modal_dialog(i.title,n),r=o.data("modal_dialog"),o.find(".cancel").click(function(e){e.preventDefault(),r.close()}),o.find(".confirm").click(function(e){e.preventDefault(),t.call(o),r.close()}),r.open()}}(jQuery)})(this),function(e){var t,i,n=e([]),o='<div class="wym_dialog wym_dialog_link"><form><fieldset class="mb0"><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_LINK+'" /><div class="row"><div class="col col-12"><label>{URL}</label><input type="text" class="wym_href text" value="" size="40" /></div></div><div class="row row-indent"><div class="col col-12"><input class="wym_submit btn btn--blue" type="submit" value="{Insert}" /><a class="wym_cancel">{Cancel}</a></div></div></fieldset></form></div>',r='<div class="wym_dialog wym_dialog_image"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_IMAGE+'" /><div class="row"><label>{URL}</label><input type="text" class="wym_src" value="" size="40" /></div><div class="row"><label>{Alternative_Text}</label><input type="text" class="wym_alt" value="" size="40" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form>',s='<div class="wym_dialog wym_dialog_table"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_TABLE+'" /><div class="row"><label>{Caption}</label><input type="text" class="wym_caption" value="" size="40" /></div><div class="row"><label>{Summary}</label><input type="text" class="wym_summary" value="" size="40" /></div><div class="row"><label>{Number_Of_Rows}</label><input type="text" class="wym_rows" value="3" size="3" /></div><div class="row"><label>{Number_Of_Cols}</label><input type="text" class="wym_cols" value="2" size="3" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form>',a='<div class="wym_dialog wym_dialog_paste"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_PASTE+'" /><div class="row"><textarea class="wym_text" rows="10" cols="50"></textarea></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form>';WYMeditor.editor.prototype.dialog=function(l,d,c){var u,h,p,f,m="",_="",g=WYMeditor.Helper;switch(this._options.dialogLinkHtml=o,this._options.dialogImageHtml=r,this._options.dialogTableHtml=s,this._options.dialogPasteHtml=a,this._options.dialogHtml=WYMeditor.DIALOG_BODY,l){case WYMeditor.DIALOG_LINK:m=this._options.dialogLinkHtml,_=I18n.t("library.modal_dialog.Insert_a_link");break;case WYMeditor.DIALOG_IMAGE:m=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:m=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:m=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:m=this._options.dialogPreviewHtml;break;default:m=c}return u=this._options.dialogHtml,u=g.replaceAll(u,WYMeditor.BASE_PATH,this._options.basePath),u=g.replaceAll(u,WYMeditor.DIRECTION,this._options.direction),u=g.replaceAll(u,WYMeditor.DIALOG_TITLE,this.encloseString(l)),u=g.replaceAll(u,WYMeditor.DIALOG_BODY,m),u=g.replaceAll(u,WYMeditor.INDEX,this._index),u=this.replaceStrings(u),_||(_=l.replace("_"," ")),n=e.create_modal_dialog(_,u),t=n.data("modal_dialog"),h=this._iframe,p=h.contentDocument&&h.contentDocument.defaultView?h.contentDocument.defaultView:h.contentWindow,i=rangy.saveSelection(p),f=this.selected(),t.open(),n.find("input:visible:first").focus(),WYMeditor.INIT_DIALOG(this._index,f),t},jQuery.fn.closeDialog=function(){rangy.restoreSelection(i),setTimeout({run:function(){t.close(),t.$elem.remove(),t=!1}}.run,250)},WYMeditor.INIT_DIALOG=function(t,n){var o,r=WYMeditor.INSTANCES[t],s=window.document,a=jQuery(r._options.dialogTypeSelector).val(),l=r.uniqueStamp(),d=e([]);a===WYMeditor.DIALOG_LINK&&(e(n).is("a")||(o=r.selected_contains("a"),o.length&&(n=o[0]))),jQuery.isFunction(r._options.preInitDialog)&&r._options.preInitDialog(r,window),n&&(d=jQuery(n),jQuery(".wym_css_class",s).val(d.attr("class")),jQuery(".wym_rel",s).val(d.attr("rel")),d.attr(WYMeditor.HREF)&&jQuery(r._options.hrefSelector).val(d.attr(WYMeditor.HREF)),jQuery(r._options.srcSelector).val(d.attr(WYMeditor.SRC)),jQuery(r._options.titleSelector).val(d.attr(WYMeditor.TITLE)),jQuery(r._options.altSelector).val(d.attr(WYMeditor.ALT))),jQuery(r._options.cancelSelector,s).click(function(){jQuery().closeDialog()}),jQuery(r._options.dialogLinkSelector+" "+r._options.submitSelector).submit(function(t){t.preventDefault();var o,s,a,d=jQuery(r._options.hrefSelector+":visible",this).val();d.length>0&&(rangy.restoreSelection(i),n&&n.tagName.toLowerCase()===WYMeditor.A?o=jQuery(n):r.selection_collapsed()?(s=r.selection(),a=s.getRangeAt(0),o=e("<a>"+d+"</a>"),a.insertNode(o[0])):(r._exec(WYMeditor.CREATE_LINK,l),o=jQuery("a[href="+l+"]",r._doc.body)),o.attr(WYMeditor.HREF,d),o.attr("target","_blank")),jQuery().closeDialog()}),r._selected_image&&(jQuery(r._options.dialogImageSelector+" "+r._options.srcSelector).val(jQuery(r._selected_image).attr(WYMeditor.SRC)),jQuery(r._options.dialogImageSelector+" "+r._options.titleSelector).val(jQuery(r._selected_image).attr(WYMeditor.TITLE)),jQuery(r._options.dialogImageSelector+" "+r._options.altSelector).val(jQuery(r._selected_image).attr(WYMeditor.ALT))),jQuery(r._options.dialogImageSelector+" "+r._options.submitSelector).submit(function(t){t.preventDefault();var i=jQuery(r._options.srcSelector).val(),n=e([]);i.length>0&&(r._exec(WYMeditor.INSERT_IMAGE,l),n=jQuery("img[src$="+l+"]",r._doc.body),n.attr(WYMeditor.SRC,i),n.attr(WYMeditor.TITLE,jQuery(r._options.titleSelector).val()),n.attr(WYMeditor.ALT,jQuery(r._options.altSelector).val())),jQuery().closeDialog()}),jQuery(r._options.dialogTableSelector+" "+r._options.submitSelector).submit(function(e){e.preventDefault();var t,i,n,o,s,a,l,d,c=jQuery(r._options.rowsSelector).val(),u=jQuery(r._options.colsSelector).val();if(c>0&&u>0){for(t=r._doc.createElement(WYMeditor.TABLE),i=null,n=null,a=jQuery(r._options.captionSelector).val(),l=t.createCaption(),l.innerHTML=a,o=0;c>o;o+=1)for(i=t.insertRow(o),s=0;u>s;s+=1)i.insertCell(s);jQuery(t).attr("summary",jQuery(r._options.summarySelector).val()),d=jQuery(r.findUp(r.container(),WYMeditor.MAIN_CONTAINERS)).get(0),d&&d.parentNode?jQuery(d).after(t):jQuery(r._doc.body).append(t)}jQuery().closeDialog()}),jQuery(r._options.dialogPasteSelector+" "+r._options.submitSelector).submit(function(e){e.preventDefault();var t=jQuery(r._options.textSelector).val();r.paste(t),jQuery().closeDialog()}),jQuery.isFunction(r._options.postInitDialog)&&r._options.postInitDialog(r,window)}}(jQuery),instrument_function(function(e){$(function(){function e(e){var t=this,i=this._iframe,n=i.contentDocument&&i.contentDocument.defaultView?i.contentDocument.defaultView:i.contentWindow,o=rangy.saveSelection(n),r={photo:I18n.t("onloads.initializers.editor.custom_commands.asset.Add_an_image"),audio:I18n.t("onloads.initializers.editor.custom_commands.asset.Add_an_audio_file"),asset_video:I18n.t("onloads.initializers.editor.custom_commands.asset.Add_a_video")},s=r[e],a=$.open_remote_modal_dialog($(t._element).data("asset_upload_url")+"&type="+e,{ignore_parent:!0,do_not_cache:!0,title:s});$(document).one("modal_dialog:remote_dialog_loaded",function(e){var i=$(e.target),n=i.find("#new_asset"),r=i.find("input[type=file]"),s=i.find("form.embed"),l=n.find(".progress"),d=n.find("input[type=submit]"),c=d.val(),u=!1;n.find("input[type=submit]"),r.ksr_uploader(),s.on("submit",function(e){var i=s.find("input#url").val();i&&($.ajax({url:s.attr("action"),type:s.attr("method"),data:{"data[data-href]":i,width:$(t._doc.body).width()-18},dataType:"html",success:function(e){var i=$(e);i.children().length?(t.insertBlock(e),t.ensure_template_links_target_top_or_new_windows(),t.insert_empty_p_if_next_block_is_uneditable()):growl({error:I18n.t("onloads.initializers.editor.custom_commands.asset.Unable_to_embed")}),a.close()},error:function(){growl({error:I18n.t("onloads.initializers.editor.custom_commands.asset.Unable_to_embed")}),a.close()}}),e.preventDefault())}),n.on("ksr_file_upload:reset",function(){n.parent().removeClass("upload_finished").removeClass("uploading"),l.removeClass("finished")}),n.on("file_queued",function(){n.parent().addClass("uploading"),n.find("input[type=submit]").val(I18n.t("onloads.initializers.editor.custom_commands.asset.Uploading_please_wait"))}),n.on("file_added",function(e,t){n.trigger("destroy"),n.attr("method","put"),n.attr("action",t.update_path),n.parent().addClass("upload_finished"),n.find(".credit_and_caption").length?d.val(c):n.submit()}),n.on("submit",function(e){function i(e){s.find("#asset_errors").remove(),s.prepend(r.html(e))}var r=$('<p id="asset_errors" class="red h6"/>'),s=n.find(".credit_and_caption"),l=n.find("input#asset_caption");return e.preventDefault(),!u&&n.parent().is(".upload_finished")?(r.empty(),l.validates_max_length(),l.validate()?void(u=$.ajax({type:n.attr("method"),url:n.attr("action"),dataType:"json",data:n.serialize(),success:function(e){var i,r=n.find("#link").val();i=r?Mustache.render('<a href="{{link_to}}">{{{inner}}}</a>',{link_to:r,inner:e.html}):$(e.html),a.$parent_modal&&(a.$parent_modal.show(),a.$parent_modal=$([])),rangy.restoreSelection(o),t.insertBlock(i),rangy.removeMarkers(o),t.insert_empty_p_if_next_block_is_uneditable(),t.ensure_template_links_target_top_or_new_windows(),a.close(),$(t._element).trigger("wymeditor:videos_changed").trigger("wym-documentHTMLUpdated")},error:function(){i(I18n.t("onloads.initializers.editor.custom_commands.asset.Something_went_wrong"))},complete:function(){u=!1}})):void i(I18n.t("onloads.initializers.editor.custom_commands.asset.Caption_must_be_less_than_255_characters"))):void 0}),$(document).one("closed.modal_dialog",function(e){if($(e.target).find("form.js-asset-upload").length){var t=$(e.target).data("modal_dialog");t&&$(e.target).remove()}})})}WYMeditor.CUSTOM_COMMANDS.push({name:"AssetVideo",run:function(){e.apply(this,["asset_video"])}}),WYMeditor.CUSTOM_COMMANDS.push({name:"AssetAudio",run:function(){e.apply(this,["audio"])}}),WYMeditor.CUSTOM_COMMANDS.push({name:"AssetPhoto",run:function(){e.apply(this,["photo"])}}),function(){var e=[];$(document).on("wym-postIframeInitialization",".editor",function(){var e=$(this),t=e.closest("form"),i=!1;e.trigger("wymeditor:videos_changed"),t.is(".edit_post")||t.bind("submit",function(n){!i&&e.is(".assets_processing")&&(n.preventDefault(),t.removeClass("submitting-non-ajax"),$.modal_confirm(function(){i=!0,e.removeClass("assets_processing"),t.submit(),i=!1},{title:I18n.t("onloads.initializers.editor.custom_commands.asset.Your_media_is_being_encoded"),message:I18n.t("onloads.initializers.editor.custom_commands.asset.We_are_harnessing_the_wonders_of_science_to_convert_your_media"),confirm_text:I18n.t("onloads.initializers.editor.custom_commands.asset.Save")}))})}),$(document).on("wymeditor:videos_changed",".editor",function(){var t=$(this),i=$.wymeditors(t.data("wym_index")),n=0;_.each(e,function(e){e.stop()}),e=[],$(".processing",i._doc).each(function(){var o=$(this);n+=1,e.push($.pollster(URI(o.data("status_path")).addQuery("width",$(i._doc.body).width()-18).toString(),function(e){if(e.html){var i=$(e.html);return n-=1,o.closest(".template").replaceWith(i),t.trigger("wymeditor:videos_changed"),t.trigger("wymeditor:video_encoded"),!0}}))}),n>0?t.trigger("wymeditor:assets_processing"):$(".failed_video",i._doc).length?t.trigger("wymeditor:assets_processing_failed"):t.trigger("wymeditor:assets_finished"),i._doc.defaultView&&i._doc.defaultView.$&&i._doc.defaultView.$.videos_changed()}),$(document).on("wymeditor:assets_processing",".editor",function(){$(this).addClass("assets_processing")}),$(document).on("wymeditor:assets_finished",".editor",function(){$(this).removeClass("assets_processing")}),$(document).on("wymeditor:assets_processing_failed",".editor",function(){$(this).removeClass("assets_processing_failed").addClass("videos_failed")}),$(document).on("ksr_video:pause_all_videos",function(){_.each(WYMeditor.INSTANCES,function(e){e._doc&&e._doc.defaultView&&e._doc.defaultView.$&&e._doc.defaultView.$(".video-player").trigger("ksr_video:pause")})})}()})})(this),instrument_function(function(e){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"Blockquote",run:function(){var e,t=$(this.selected()),i=t.closest("blockquote");i.length?(e=$("<p></p>"),t.is(":first-child")?i.before(e):i.after(e),e.append(t),(i.is(":empty")||!i.find("p:not(:empty)").length)&&i.remove(),this.setFocusToNode(e[0])):this.container("blockquote")}})})})(this),instrument_function(function(e){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"Code",run:function(e){var t=this,i=e||$([]),n=i.html()||"",o=i.data("style")||"",r=$.create_modal_dialog(I18n.t("onloads.initializers.editor.custom_commands.code.Code_it_up"),'<form><input class="style" value="'+o+'"/><textarea class="code">'+_.unescape(n)+'</textarea><input type="submit" /></form>'),s=r.data("modal_dialog");s.open(),r.find("form").on("submit",function(e){e.preventDefault();var n=$(this),o=_.escape(n.find("textarea.code").val()),r=n.find("input.style").val();i.length?i.html(o):t.insertBlock('<pre class="template code brush: '+r+'" data-style="'+r+'" contenteditable="false">'+o+"</pre>"),s.close()})}}),$(".editor").on("wym-postIframeInitialization",function(){var e=$(this),t=$.wymeditors(e.data("wym_index")),i=t._doc;$(i).on("click","pre.code",function(){var e=$(this);e.find("ul.field-tools").remove(),t.exec("Code",[e])})})})})(this),instrument_function(function(e){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"Headerify",run:function(){$(this.selected()).is("h1")?this.container("p"):this.container("h1")}})})})(this),instrument_function(function(e){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"KsrProject",run:function(){var e=this,t=this._iframe,i=t.contentDocument&&t.contentDocument.defaultView?t.contentDocument.defaultView:t.contentWindow,n=rangy.saveSelection(i),o=!1,r="",s="video",a=this.dialog(I18n.t("onloads.initializers.editor.custom_commands.project.Add_a_project"),!1,'<form class="find_project"><fieldset><label>'+I18n.t("onloads.initializers.editor.custom_commands.project.Project")+'</label><div class="field search"><span class="ss-icon ss-search z3"></span><span class="ss-icon ss-delete z3"></span><input type="text" class="find-project text z2" name="q" size="40"/><div class="results z1 limited-height"><span class="ss-icon ss-directup"></div></div></fieldset><fieldset><select name="type"><option value="video">'+I18n.t("onloads.initializers.editor.custom_commands.project.video")+'</option><option value="widget">'+I18n.t("onloads.initializers.editor.custom_commands.project.widget")+'</option></select></fieldset><input type="submit" value="'+I18n.t("onloads.initializers.editor.custom_commands.project.Insert")+'" class="btn btn--blue"/><a class="wym_cancel">'+I18n.t("onloads.initializers.editor.custom_commands.project.Cancel")+"</a></form>"),l=a.$elem,d=l.find("input.find-project");d.closest(".field").livesearch_selector({url:"/projects/options.js",serialize:d,process_data:function(e){return e+"&video=true&widget=true"},cancel_copy:""}),l.on("livesearch:selected",function(e,t){o=t[1],r=t[2]}),d.on("livesearch_selector:unselect",function(){o=!1}),l.on("submit",function(e){e.preventDefault()}),l.one("submit",function(){if(o){s=l.find("form select").val();var t='<div class="template '+s+'" contentEditable="false" data-id="'+o+'">'+r[s]+"</div>";rangy.restoreSelection(n),rangy.removeMarkers(n),e.insertBlock(t),e.ensure_template_links_target_top_or_new_windows(),e.insert_empty_p_if_next_block_is_uneditable(),a.close()}})}})})})(this),instrument_function(function(e){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"KsrReward",run:function(){var e=this,t=this._iframe,i=t.contentDocument&&t.contentDocument.defaultView?t.contentDocument.defaultView:t.contentWindow,n=rangy.saveSelection(i),o=!1,r=[],s=this.dialog(I18n.t("onloads.initializers.editor.custom_commands.reward.Add_a_project_reward"),!1,'<form class="find_project_reward"><fieldset><label>'+I18n.t("onloads.initializers.editor.custom_commands.reward.Project")+'</label><div class="field search"><span class="ss-icon z3 ss-search"></span><span class="ss-icon z3 ss-delete"></span><input type="text" class="find-project text z2" name="q" size="40"/><div class="results z1 limited-height"><span class="ss-icon ss-directup"></div></div></fieldset><fieldset class="reward" style="display:none;"><label>'+I18n.t("onloads.initializers.editor.custom_commands.reward.Reward")+'</label><select name="reward"></select></fieldset><input type="submit" value="'+I18n.t("onloads.initializers.editor.custom_commands.reward.Insert")+'" class="btn btn--blue"/><a class="wym_cancel">'+I18n.t("onloads.initializers.editor.custom_commands.reward.Cancel")+"</a></form>"),a=s.$elem,l=a.find("input.find-project"),d=a.find("select");l.closest(".field").livesearch_selector({url:"/projects/options.js",serialize:l,process_data:function(e){return e+"&rewards=true"},cancel_copy:""}),a.on("livesearch:selected",function(e,t){o=t[1],d.empty(),r=[],$.each(t[2].rewards,function(e){r.push(this.html),d.append('<option value="'+e+'">'+this.minimum+"\u2013"+this.reward+"</option>")}),d.closest("fieldset").slideDown()}),l.on("livesearch_selector:unselect",function(){d.empty(),d.closest("fieldset").slideUp(),o=!1}),a.on("submit",function(e){e.preventDefault()}),a.one("submit",function(){if(o){var t=a.find("form select").val(),i=r[t];rangy.restoreSelection(n),rangy.removeMarkers(n),e.insertBlock(i),e.ensure_template_links_target_top_or_new_windows(),
e.insert_empty_p_if_next_block_is_uneditable(),s.close()}})}})})})(this),instrument_function(function(e){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"ReadMore",run:function(){$(this._doc).find("div.read_more").remove(),this.insertBlock('<div class="read_more" contentEditable="false"></div>'),this.insert_empty_p_if_next_block_is_uneditable()}})})})(this),instrument_function(function(e){$(function(){WYMeditor.CUSTOM_COMMANDS.push({name:"ToggleUnorderedList",run:function(){var e,t=this.selected(),i=$(t),n=i.closest("li");n.length?(e=$(this.getCommonParentList(n,!0)),e.after("<p>"+i.text()+"</p>"),i.remove(),e.closest("ul:empty").remove()):this.insertUnorderedlist()}})})})(this),instrument_function(function(e){$(function(){WYMeditor.STRINGS.en={Strong:I18n.t("onloads.initializers.editor.lang.Strong"),Emphasis:I18n.t("onloads.initializers.editor.lang.Emphasis"),Superscript:I18n.t("onloads.initializers.editor.lang.Superscript"),Subscript:I18n.t("onloads.initializers.editor.lang.Subscript"),Ordered_List:I18n.t("onloads.initializers.editor.lang.Ordered_List"),Unordered_List:I18n.t("onloads.initializers.editor.lang.Unordered_List"),Indent:I18n.t("onloads.initializers.editor.lang.Indent"),Outdent:I18n.t("onloads.initializers.editor.lang.Outdent"),Undo:I18n.t("onloads.initializers.editor.lang.Undo"),Redo:I18n.t("onloads.initializers.editor.lang.Redo"),Link:I18n.t("onloads.initializers.editor.lang.Link"),Unlink:I18n.t("onloads.initializers.editor.lang.Unlink"),Image:I18n.t("onloads.initializers.editor.lang.Image"),Table:I18n.t("onloads.initializers.editor.lang.Table"),HTML:I18n.t("onloads.initializers.editor.lang.HTML"),Paragraph:I18n.t("onloads.initializers.editor.lang.Paragraph"),Heading_1:I18n.t("onloads.initializers.editor.lang.Heading_1"),Heading_2:I18n.t("onloads.initializers.editor.lang.Heading_2"),Heading_3:I18n.t("onloads.initializers.editor.lang.Heading_3"),Heading_4:I18n.t("onloads.initializers.editor.lang.Heading_4"),Heading_5:I18n.t("onloads.initializers.editor.lang.Heading_5"),Heading_6:I18n.t("onloads.initializers.editor.lang.Heading_6"),Header:I18n.t("onloads.initializers.editor.lang.Header"),Preformatted:I18n.t("onloads.initializers.editor.lang.Preformatted"),Blockquote:I18n.t("onloads.initializers.editor.lang.Blockquote"),Table_Header:I18n.t("onloads.initializers.editor.lang.Table_Header"),URL:I18n.t("onloads.initializers.editor.lang.URL"),Title:I18n.t("onloads.initializers.editor.lang.Title"),Relationship:I18n.t("onloads.initializers.editor.lang.Relationship"),Alternative_Text:I18n.t("onloads.initializers.editor.lang.Alternative_Text"),Caption:I18n.t("onloads.initializers.editor.lang.Caption"),Summary:I18n.t("onloads.initializers.editor.lang.Summary"),Number_Of_Rows:I18n.t("onloads.initializers.editor.lang.Number_Of_Rows"),Number_Of_Cols:I18n.t("onloads.initializers.editor.lang.Number_Of_Cols"),Submit:I18n.t("onloads.initializers.editor.lang.Submit"),Insert:I18n.t("onloads.initializers.editor.lang.Insert"),Cancel:I18n.t("onloads.initializers.editor.lang.Cancel"),Choose:I18n.t("onloads.initializers.editor.lang.Choose"),Preview:I18n.t("onloads.initializers.editor.lang.Preview"),Paste_From_Word:I18n.t("onloads.initializers.editor.lang.Paste_From_Word"),Tools:I18n.t("onloads.initializers.editor.lang.Tools"),Containers:I18n.t("onloads.initializers.editor.lang.Containers"),Classes:I18n.t("onloads.initializers.editor.lang.Classes"),Status:I18n.t("onloads.initializers.editor.lang.Status"),Source_Code:I18n.t("onloads.initializers.editor.lang.Source_Code"),Project:I18n.t("onloads.initializers.editor.lang.Project"),Reward:I18n.t("onloads.initializers.editor.lang.Reward"),Code:I18n.t("onloads.initializers.editor.lang.Code"),ReadMore:I18n.t("onloads.initializers.editor.lang.ReadMore"),Asset_Photo:I18n.t("onloads.initializers.editor.lang.Asset_Photo"),Asset_Video:I18n.t("onloads.initializers.editor.lang.Asset_Video"),Asset_Audio:I18n.t("onloads.initializers.editor.lang.Asset_Audio")}})})(this),instrument_function(function(e){$(function(){WYMeditor.SKINS.ksr={},WYMeditor.SKINS.ksr_chromeless={};var e={Bold:{name:"Bold",title:"Strong",css:"wym_tools_strong"},Italic:{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},Superscript:{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},Subscript:{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},InsertOrderedList:{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},ToggleUnorderedList:{name:"ToggleUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list",html:'<li><a name="ToggleUnorderedList" href="#" title="'+I18n.t("onloads.initializers.editor.editor.List")+'"><span class="ss-icon ss-list"></span></a></li>'},Indent:{name:"Indent",title:"Indent",css:"wym_tools_indent"},Outdent:{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},Undo:{name:"Undo",title:"Undo",css:"wym_tools_undo"},Redo:{name:"Redo",title:"Redo",css:"wym_tools_redo"},CreateLink:{name:"CreateLink",title:"Link",css:"wym_tools_link",html:'<li class="wym_tools_link"><a name="CreateLink" href="#" title="'+I18n.t("onloads.initializers.editor.editor.Link")+'"><span class="ss-icon ss-link"></span></a></li>'},Unlink:{name:"Unlink",title:"Unlink",css:"wym_tools_unlink",html:'<li class="wym_tools_unlink"><a name="Unlink" href="#" title="'+I18n.t("onloads.initializers.editor.editor.Unlink")+'"><span class="ss-icon ss-unlink"></span></a></li>'},AssetVideo:{name:"AssetVideo",title:"Asset_Video",css:"wym_tools_asset_video",html:'<li><a name="AssetVideo" href="#" title="'+I18n.t("onloads.initializers.editor.editor.Video")+'"><span class="ss-icon ss-video"></span></a></li>'},AssetAudio:{name:"AssetAudio",title:"Asset_Audio",css:"wym_tools_asset_audio",html:'<li><a name="AssetAudio" href="#" title="'+I18n.t("onloads.initializers.editor.editor.Audio")+'"><span class="ss-icon ss-music"></span></a></li>'},AssetPhoto:{name:"AssetPhoto",title:"Asset_Photo",css:"wym_tools_asset_photo",html:'<li><a name="AssetPhoto" href="#" title="'+I18n.t("onloads.initializers.editor.editor.Image")+'"><span class="ss-icon ss-picture"></span></a></li>'},InsertImage:{name:"InsertImage",title:"Image",css:"wym_tools_image"},InsertTable:{name:"InsertTable",title:"Table",css:"wym_tools_table"},Paste:{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},ToggleHtml:{name:"ToggleHtml",title:"HTML",css:"wym_tools_html",html:'<li class="wym_tools_html"><a name="ToggleHtml" href="#" title="'+I18n.t("onloads.initializers.editor.editor.HTML")+'"><span class="ss-icon ss-navigateleft"></span><span class="ss-icon ss-navigateright"></span></a></li>'},Preview:{name:"Preview",title:"Preview",css:"wym_tools_preview"},Headerify:{name:"Headerify",title:"Header",css:"wym_tools_header"},Blockquote:{name:"Blockquote",title:"Blockquote",css:"wym_tools_blockquote"},Code:{name:"Code",title:"Code",css:"wym_tools_code"},KsrProject:{name:"KsrProject",title:"Project",css:"wym_tools_project"},KsrReward:{name:"KsrReward",title:"Reward",css:"wym_tools_reward"},ReadMore:{name:"ReadMore",title:"ReadMore",css:"wym_tools_read_more"}},t={skin:"ksr",iframeBasePath:"/wymeditor_iframe/",logoHtml:"",disable_sanitization:!0,wymPath:" ",boxHtml:'<div class="wym_box"><div class="wym_area_top">'+WYMeditor.TOOLS+'</div><div class="wym_area_left"></div><div class="wym_area_right"></div><div class="wym_area_main">'+WYMeditor.HTML+WYMeditor.IFRAME+'</div><div class="wym_area_bottom"></div></div>',htmlHtml:'<div class="wym_html wym_section"><textarea class="wym_html_val"></textarea></div>',postInit:function(e){var t=$(e._doc.body),i=$(e._element);e.ensure_template_links_target_top_or_new_windows=function(){t.on("click",".template a",function(e){var t=$(e.currentTarget);t.is(".js-preserve-navigation")||t.closest(".js-preserve-navigation").length||(e.preventDefault(),this.host===window.top.location.host?window.top.location=this.href:window.open(this.href))})},t.on("dragover drop",function(e){return e.preventDefault(),!1}),$(e._iframe.contentWindow).on("focus",function(e){i.trigger("wym."+e.type)}),t.html(e.xhtml()),t.find(".template").attr("contentEditable","false"),e.ensure_template_links_target_top_or_new_windows(),e.insert_empty_p_if_next_block_is_uneditable(),t.on("mouseenter",".template, .read_more",function(){var t=$('<li class="delete"><a href="#" class="delete template-delete" title="'+I18n.t("onloads.initializers.editor.editor.Delete")+'"><span class="ss-icon ss-delete"></span></a></li>'),n=$([]),o=$(this),r=$('<ul class="field-tools js-preserve-navigation"></ul>'),s=o.attr("data-edit_url");o.find(".field-tools").length||(t.click(function(t){t.preventDefault(),o.remove(),i.trigger("wym-documentHTMLUpdated",[e,$(e._doc.body).html()])}),s&&(n=$('<li class="edit"><a href="'+s+'" class="edit template-edit" title="'+I18n.t("onloads.initializers.editor.editor.Edit")+'"><span class="ss-icon ss-write"></span></a></li>'),n.click(function(t){t.preventDefault();var n=$.open_remote_modal_dialog(s,{title:I18n.t("onloads.initializers.editor.editor.Update_Image_Caption"),do_not_cache:!0});n.$elem.on("modal_dialog:remote_dialog_loaded",function(){var t=$(this).find("form"),r=t.find("#link"),s=o.parent("a");r.val(s.attr("href")),$(this).find("form").on("submit",function(a){a.preventDefault(),$.ajax({url:t.attr("action"),data:t.serialize(),type:t.attr("method"),dataType:"json",success:function(t){var a=r.val(),l=!!s.length,d=$(t.html);o.replaceWith(d),o=d,a?l?s.attr("href",a):o.wrap('<a href="'+a+'"></a>'):l&&o.unwrap(),i.trigger("wym-documentHTMLUpdated",[e,$(e._doc.body).html()]),n.close()}})})})}),r.append(n)),r.append(t),o.append(r))}),t.on("mouseleave",".template, .read_more",function(){$(this).find(".field-tools").remove()})},updateSelector:"form",updateEvent:"submit",before_sanitize:function(e){if(e){var t=this,i=$(t._doc.body).clone();return i.find(".template").has("embed, object, iframe").empty(),i.html()}return!1},before_update:function(){var e=this;$(e._doc.body).find(".template").has("embed, object, iframe").empty(),$(e._doc.body).find(".field-tools").remove()}},i=$.extend({},t,{skin:"ksr_chromeless",toolsItems:[]});$(".editor:visible").livequery(function(){var n,o=$(this),r=[],s=$.extend({},t);o.data("wym_index")||(o.is(".chromeless")?o.wymeditor(i):($.each(o.data("tools").split(" "),function(){var t=this.toString();e[t]?r.push(e[t]):$.console.log("Editor - missing tool: "+t)}),$.extend(s,{toolsItems:r}),o.wymeditor(s)),n=$.wymeditors(o.data("wym_index")),o.closest("form").on("ajaxForm:beforeSerialize",function(){n.update()}),o.is(".resizable")&&n.resizable({iframeFix:!0}),o.on("destroy",function(){if($.browser.msie){var e=$("<input></input>");$("body").append(e),e.focus(),e.remove()}}))}),$.ui.plugin.add("resizable","iframeFix",{start:function(){var e=$(this).data("resizable"),t=e?e.options:{};e&&$(t.iframeFix===!0?"iframe":t.iframeFix).each(function(){$('<div class="ui-resizable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")})},stop:function(){$("div.ui-resizable-iframeFix").each(function(){this.parentNode.removeChild(this)})}})})})(this),instrument_function(function(e){$(".editor").livequery("wym-postIframeInitialization",function(){var e=$.wymeditors($(this).data("wym_index")),t=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/|[a-z0-9.\-]+[.](?:com|org|net))(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))*(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:''.,<>?\xab\xbb\u201c\u201d\u2018\u2019]|\b))/gi,i=[13,32,192,219,221,59,188,222];$(e._doc.body).on("keyup paste",function(n){var o,r,s=!1;$.each(i,function(){return n.keyCode===parseInt(this,10)?(s=!0,!1):void 0}),(s||"paste"===n.type)&&(o=$(this),r=function(){function i(){return 3===this.nodeType}function n(){for(var t,i,n,r=e._iframe,s=r.contentDocument&&r.contentDocument.defaultView?r.contentDocument.defaultView:r.contentWindow,a=rangy.saveSelection(s),l=$(this).text(),d=l.indexOf(o[0]);-1!==d;)"@"!==l[d-1]&&(t=l.split(""),i=l.slice(0,d),n=l.slice(d+o[0].length,l.length),l=i+'<a href="'+o[0]+'">'+o[0]+"</a>"+n),d=l.indexOf(o[0],d+2*o[0].length+15);$(this).replaceWith(l),rangy.restoreSelection(a),rangy.removeMarkers(a)}for(var o,r,s=$(e.selected()),a=s.html();null!==(o=t.exec(a));)o[0]=o[0].replace(/&nbsp$/,""),o[0]=$("<div/>").html(o[0]).remove().text(),r=s.contents().filter(i),r.each(n)},"paste"===n.type?setTimeout(r,500):r())})})})(this),instrument_function(function(e){$(".editor").on("wym-postIframeInitialization",function(){var e,t=$(this),i=$.wymeditors(t.data("wym_index"));e=t.closest("fieldset").find(".character-counter"),e.length&&t.on("wym-postIframeInitialization",function(){function n(){var t=i.html(),n=$("<div>"+t+"</div>"),o=n.text();e.text(r-o.length)}var o=$(i._doc),r=parseInt(e.data("maxlength"),10);o.on("keyup paste cut",n),t.on("change",function(){setTimeout(n,100)})})})})(this),instrument_function(function(e){$(".editor").livequery("wym-postIframeInitialization",function(){function e(){d.remove(),l&&(rangy.restoreSelection(l),rangy.removeMarkers(l),l=!1)}function t(){setTimeout(function(){if(d.length){var t=d.val();s.paste(t),e()}},5)}function i(){var e=s._iframe,t=e.contentDocument&&e.contentDocument.defaultView?e.contentDocument.defaultView:e.contentWindow;l=rangy.saveSelection(t),d=$('<textarea class="wym_paste"></textarea>',s._doc),a.append(d),d.css({position:"absolute",top:-10,width:1,height:1,overflow:"hidden"}),d.focus()}function n(){var e=!1;return-1!==navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!==navigator.appVersion.indexOf("Mac")&&(e="Mac"),-1!==navigator.appVersion.indexOf("X11")&&(e="UNIX"),-1!==navigator.appVersion.indexOf("Linux")&&(e="Linux"),e}function o(e){return("Mac"===n()?e.metaKey:e.ctrlKey)&&86===e.keyCode||e.shiftKey&&45===e.keyCode?!0:!1}function r(i){var n=i.originalEvent||i;return n.clipboardData&&n.clipboardData.getData?(i.preventDefault(),e(),n.clipboardData.getData("text/plain")):void t()}var s=$.wymeditors($(this).data("wym_index")),a=$(s._doc.body),l=!1,d=$([]);a.on("keydown",function(e){$.browser.webkit||$.browser.msie||$.browser.mozilla&&$.browser.version>=22||o(e)&&i()}),a.on("paste",function(e){var t=r(e);t&&s.paste(t)})}),WYMeditor.editor.prototype.paste=function(e){var t,i,n,o="";if(t=e.split(new RegExp(WYMeditor.NEWLINE+"{2,}","g")),t.length>1){for(i=0,n=t.length;n>i;i+=1)o+="<p>"+t[i].split(this._newLine).join("<br />")+"</p>";this.insertBlock(o)}else this.insertText(t[0]);jQuery("body > br",this._doc).remove()}})(this),instrument_function(function(e){!function(e){function t(t){t.each(function(){var t=e(this),i=t.find("option:selected");t.siblings(".title").text(i.data("altLabel")||i.text())})}e.fn.ksrSelect=function(){var i=e(this);i.find(".ksr-select").livequery(function(){t(e(this).find("select"))}),i.on("focus blur",".ksr-select select",function(){e(this).parent().toggleClass("is-focus")}),i.on("change",".ksr-select select",function(){t(e(this))}),i.on("keydown",".ksr-icon__arrow-down, .ss-delete",function(t){var i=e(this),n=t.keyCode;(n===KEY.ENTER||n===KEY.SPACE)&&(t.preventDefault(),i.hasClass("ss-delete")&&i.parent().find(".ksr-icon__arrow-down").focus(),i.click())})},e.fn.ksr_val=function(i){var n=e(this);if(void 0!==i){var o=n.val(i);return t(n),o}return n.val()}}(jQuery)})(this),$(".editor").livequery("wym-postIframeInitialization",function(){var e=$.wymeditors($(this).data("wym_index"));$(e._doc.body).ksrSelect()}),instrument_function(function(e){!function(e){function t(t){var i=t.data("status-url");i&&e.pollster(i,function(i){var n,o=t.data("track-label");return i.ok?(n=e(i.html),t.replaceWith(n),growl({success:I18n.t("library.video_tracks_editor.Successfully_imported_label",{label:o})}),!0):i.error?(n=e(i.html),t.replaceWith(n),growl({error:I18n.t("library.video_tracks_editor.Something_went_wrong_while_importing_label",{label:o,error:i.error})}),!0):!1},{delay:1e3})}e.fn.videoTracksEditor=function(){var i=e(this);i.on("click",".js-add-track",function(t){var i,n=e(t.currentTarget),o=n.closest(".js-subtitles"),r=o.find(".js-language-select"),s=o.find(".js-track-list"),a=r.find("option:selected").val();i=e.ajax({method:"POST",url:n.data("create-track-path"),data:{language:a,captionable_type:n.data("captionable-type"),captionable_id:n.data("captionable-id")},dataType:"json"}),i.success(function(e){s.append(e.html),o.find(".js-empty-tracks").hide(),r.find('option[value="'+a+'"]').prop("disabled",!0),r.ksr_val(r.find("option").not("[disabled]").first().val())}),t.preventDefault()}),i.on("click",".js-captionable--destroy-track",function(t){var i,n=e(t.currentTarget),o=n.closest(".js-subtitles"),r=o.find(".js-language-select"),s=n.data("path");t.preventDefault(),confirm(I18n.t("library.video_tracks_editor.Are_you_sure_you_want_to_delete_this_track"))&&(i=e.ajax({method:"DELETE",url:s}),i.success(function(e){var t=n.data("language");e.ok&&(r.find('option[value="'+t+'"]').prop("disabled",!1),n.closest(".js-captionable--track-item").remove(),0===o.find(".js-captionable--track-item").length&&o.find(".js-empty-tracks").show())}))}),i.on("change",".js-importer--input",function(){var i,n=e(this),o=n.closest(".js-importer"),r=n.closest(".js-captionable--track-item"),s=o.find(".js-importer--text"),a=this.files&&this.files[0],l=new FormData;a&&(n.hide(),s.text(I18n.t("library.video_tracks_editor.Uploading")),l.append("track[file]",a),i=e.ajax({url:n.data("url"),type:"PUT",processData:!1,contentType:!1,data:l}),i.success(function(i){var n;i.ok?(n=e(i.html),r.replaceWith(n),t(n)):growl({error:i.error})}),i.error(function(){growl({error:I18n.t("library.video_tracks_editor.Something_went_wrong_while_uploading_file",{file:a.name})}),n.show()}))}),i.find(".js-captionable--track-item").each(function(){var i=e(this);t(i)})}}(jQuery)})(this),$(".editor").livequery("wym-postIframeInitialization",function(){var e=$.wymeditors($(this).data("wym_index"));$(e._doc.body).videoTracksEditor()});